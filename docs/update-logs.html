<html>

<head>
  <title>Update Logs | InPageEdit-v2 | A MediaWiki Quick Edit Gadget by Dragon Fish</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=yes">
  <meta name="keywords" content="InPageEdit,InPageEdit-v2,MediaWiki,MediaWiki Gadget">
  <link href="src/style.css" rel="stylesheet">
  <script src="src/jquery.min.js"></script>
</head>

<body class="github-page">

  <article>
    <h1>InPageEdit-v2 Update Logs</h1>
    <div class="bread-crumb"><a href="index.html">InPageEdit-v2</a> <span class="gt">&gt;</span> <b class="this-page">Update Logs</b></div>

    <main>
      <div id="updatelogs-progress" style="margin: 80px auto; text-align: center;"><img
          src="src/ms-loading-spinner.svg"><br>Loading data...</div>
    </main>

    <footer>
      <hr>
      <p>InPageEdit-v2 is a MediaWiki plugin based on JavaScript. And write by <a
          href="https://epbureau.fandom.com/wiki/%E6%9C%BA%E6%99%BA%E7%9A%84%E5%B0%8F%E9%B1%BC%E5%90%9B">机智的小鱼君</a>
      </p>
      <p>© Original by Wjghj Project, <a href="https://www.gnu.org/licenses/gpl-3.0-standalone.html">GNU General
          Public
          License 3.0</a> (2019 - <span id="thisYear"></span>)<br>
        See more: <a href="https://github.com/Dragon-Fish/InPageEdit-v2">GitHub</a> | <a href="update-logs.html">Update
          logs</a> | <a href="https://github.com/Dragon-Fish/InPageEdit-v2/issues">File issues</a></p>
    </footer>
  </article>

  <script>
    $(function () {
      // AJAX获取更新列表的json
      $.ajax({
        url: 'update-logs.json',
        dataType: 'json',
        success: function (data) {
          var data = data || {};

          // 更新列表偶尔会采取简单的markdown语法，格式化
          function conversion(text) {
            var text = text;
            if (typeof text !== 'string') return 'Error.';
            text = text
              .replace(/\[\[(issues|pull)\#(.+?)\]\]/g, '[https://github.com/Dragon-Fish/InPageEdit-v2/$1/$2]($1#$2)') // issues 或 pull
              .replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$1" target="_blank">$2</a>') // 链接
              .replace(/<(http:\/\/|https:\/\/)(.+?)>/g, '<a href="$1$2" target="_blank>$1$2</a>') // 直接链接
              .replace(/\*\*(.+?)\*\*/g, '<b>$1</b>') // 粗体
              .replace(/\*(.+?)\*/g, '<i>$1</i>') // 斜体
              .replace(/`(.+?)`/g, '<code>$1</code>');
            return text;
          }

          // 将json数据格式化为html
          var list = data.list || [];
          var html = $('<section>', { class: 'ipe-update-logs', style: 'display:none' }); // 创建外部html

          // 遍历整体数组
          for (var k1 = 0; k1 < list.length; k1++) {
            var version = list[k1]['version'], // 本次遍历的版本号
              date = list[k1]['date'] || '-', // 本次遍历的更新时间
              description = list[k1]['description'] || []; // 本次遍历的说明列表

            // 建立本次遍历的外部html
            var versionGroup = $('<div>', { class: 'version-group' });
            var versionHTML = $('<h2>', { text: version, id: version.replace(/\./g, '-').replace(/\(/g, '_').replace(/\)/g, '') }), // 本次遍历的版本的html对象
              dateHTML = $('<p>', { text: 'Release date: ' + date }); // 本次遍历的时间的html对象

            // 遍历说明列表
            for (var k2 = 0; k2 < description.length; k2++) {
              var type = description[k2]['type'] || 'note', // 本次遍历的变更类型
                type = type.toLowerCase(), // 统一转换为小写
                main = description[k2]['main'] || '', // 本次遍历的主要文字
                more = description[k2]['more'] || []; // 本次遍历的更多说明列表
              if (typeof more === 'string') more = [more]; // 将更多说明转换为数组

              var versionChanges = $('<ul>', { class: 'version-chages-list' }), // 建立外部乱序列表项
                typeHTML = $('<span>', { text: type, class: 'status-tag ' + type }), // 将更改类型装换位html对象
                mainHTML = $('<li>', { class: 'version-chage', html: typeHTML.prop('outerHTML') + conversion(main) }), // 将主要说明组合为html对象
                moreHTML = $('<ul>', { class: 'change-more-info' }); // 建立更多说明的乱序列表

              for (var k3 = 0; k3 < more.length; k3++) {
                moreHTML.append(
                  $('<li>', { html: conversion(more['k3']) })
                )
              }
              versionChanges.append(
                mainHTML,
                moreHTML
              );
            }
            versionGroup = versionGroup.append(
              versionHTML,
              dateHTML,
              versionChanges
            );
            html = html.append(versionGroup);
          }

          // 安置文档
          $('#updatelogs-progress')
            .after(html) // 插入html
            .addClass('done') // 将progress切换为完成
            .delay(300).fadeOut(700); // 1s后隐藏progress
          // 将版本号显示在标题
          $('#yourVersion').html(localStorage.InPageEditVersion);
          // 1s后显示html
          setTimeout(function () {
            $('.ipe-update-logs').show(800);
          }, 1000);
        },
        fail: function () {
          // placeholder
        }
      });
    });
  </script>
</body>

</html>