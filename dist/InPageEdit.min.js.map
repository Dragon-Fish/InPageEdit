{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./module/_msg.js","webpack:///./module/_elements.js","webpack:///./module/_analysis.js","webpack:///./method/_dir.js","webpack:///./module/version.js","webpack:///./module/preference.js","webpack:///./module/_hasRight.js","webpack:///./module/quickEdit.js","webpack:///./module/progress.js","webpack:///./module/quickDiff.js","webpack:///./module/versionInfo.js","webpack:///./module/specialNotice.js","webpack:///./module/articleLink.js","webpack:///./module/findAndReplace.js","webpack:///./module/quickPreview.js","webpack:///./module/quickDelete.js","webpack:///./module/_resolveExists.js","webpack:///./index.js","webpack:///./method/init.js","webpack:///./method/loadScript.js","webpack:///./method/getUserInfo.js","webpack:///./method/loadStyles.js","webpack:///./method/updateNotice.js","webpack:///./method/syncI18nData.js","webpack:///./module/about.js","webpack:///./module/loadQuickDiff.js","webpack:///./module/pluginStore.js","webpack:///./module/quickRedirect.js","webpack:///./module/quickRename.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","userLang","mw","config","fallbacks","makeLink","href","text","hasProtocol","blank","util","getUrl","html","escape","parseWikitext","message","context","$html","$div","whitelistAttrs","whitelistTags","indexOf","document","implementation","createHTMLDocument","$","parseHTML","append","find","each","attrs","style","$this","this","tagname","prop","toLowerCase","log","remove","Array","slice","forEach","attr","removeAttr","replace","_match","count","forms","language","convertPlural","Number","split","gender","parseMessage","msg","args","elem","index","rgx","RegExp","handleArgs","getMessage","lang","msgKey","i18nCache","localStorage","getItem","after","length","join","cacheMessages","data","JSON","parse","e","toObject","overrides","window","InPageEdit","i18n","_msg","$progress","$br","br","$hr","hr","progress","api","_analysis","functionID","doNotCollectMyInfo","submitdata","wgServer","wgArticlePath","wgSiteName","wgUserName","ajax","url","analysis","type","dataType","done","console","status","_dir","thisUrl","currentScript","src","pop","version","preference","doNotShowLocalWarn","editMinor","editSummary","lockToolBox","redLinkQuickEdit","outSideClose","watchList","Boolean","user","options","setting","undefined","local","myPreference","extend","json","default","set","settingKey","settingValue","stringify","setItem","modal","hook","fire","ssi_modal","show","title","content","id","class","for","placeholder","analysisUrl","onclick","target","click","dialog","className","center","okBtn","label","val","sizeClass","buttons","method","a","confirm","cancelBtn","res","close","onShow","setData","checked","change","prepend","_hasRight","right","wgUserIsBlocked","mwApi","Api","findAndReplace","quickPreview","quickDiff","quickEdit","page","defaultOptions","wgPageName","pageId","revision","summaryRevision","section","editText","editNotice","jsonGet","action","format","jsonPost","pageDetail","jumpTo","reload","userPreference","date","Date","timestamp","getTime","now","toUTCString","decodeURIComponent","wgCurRevisionId","notify","oldid","$modalTitle","$editTools","$editArea","$optionsLabel","$modalContent","time","info","table","result","minor","summary","basetimestamp","starttimestamp","errorformat","saveError","errorCode","feedback","errorThrown","errorInfo","errorMore","errors","code","edit","warning","position","closeAfter","error","postWithToken","unbind","setTimeout","location","fail","postArticle","pst","hide","css","height","appendTo","btns","btn","open","middle","icon","preventDefault","strings","obj","textarea","start","selectionStart","stop","selectionEnd","selectedText","selectStart","setSelectionRange","focus","insertText","contentDone","summaryVal","warn","wikitext","pageid","fadeIn","sections","line","anchor","diffJson","fromrev","totext","hideBtn","pageName","isPreview","fromsection","queryJson","inprop","queryDone","namespace","query","pages","protection","revisions","level","wgNamespaceNumber","addClass","namespaceNoticePage","pageNoticePage","wgFormattedNamespaces","meta","ammessages","wikitextNs","allmessages","wikitextPage","post","contentmodel","preview","notice","pageids","titles","timeEnd","b","keepContent","beforeClose","templateName","templates","imageName","images","wgScript","iiprop","imageinfo","load","removeClass","closeIcon","articleLink","param","$diffArea","$loading","loader","wikiScript","fixedHeight","fitScreen","topst","fromtext","frompst","toTitle","diffTable","compare","totitle","userLink","colspan","fromrevid","fromtitle","fromuser","fromparsedcomment","torelative","torevid","touser","toparsedcomment","fromsize","tosize","warnings","fromtexthidden","totexthidden","fromuserhidden","touserhidden","fromcommenthidden","tocommenthidden","versionInfo","updatelogsUrl","githubLink","aboutUrl","specialNotice","element","getParamValue","substr","splitStr","substring","wgIsArticle","origin","rows","searchexp","searchfor","$textarea","replacewith","flagg","flagi","enableregex","flags","rcount","matched","match","params","modalSize","disableeditsection","test","parent","then","quickDelete","givenReason","reason","beforeShow","_resolveExists","canDelete","delete","init","mainFunctions","loadScript","getUserInfo","loadStyles","updateNotice","syncI18nData","async","about","loadQuickDiff","pluginStore","quickRedirect","quickRename","fnr","diff","redirect","quickMove","rename","freeze","crossDomain","cache","getRights","rights","getName","list","usprop","ususers","users","blockid","link","rel","InPageEditVersion","resetOnHover","cacheUrl","localCacheName","getOriginalData","getJSON","saveToCache","noCache","wgUserLanguage","en","addLink","ipeDiffLink","curid","toid","torev","setInterval","wgAction","before","pluginsIndex","question","createonly","failed","fromPage","toPage","from","to","movetalk","movesubpages","noredirect"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,I,gBClFrD,MACMC,EAAWC,GAAGC,OAAOrB,IAAI,kBACzBsB,EAAY,CAChB,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,MACP,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,GAAM,KACN,GAAM,KACN,GAAM,KACN,IAAO,KACP,UAAW,MACX,IAAO,KACP,WAAY,YACZ,GAAM,MACN,IAAO,KACP,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,UAAW,KACX,GAAM,KACN,IAAO,WACP,IAAO,WACP,WAAY,KACZ,IAAO,KACP,GAAM,KACN,QAAS,KACT,QAAS,KACT,YAAa,KACb,IAAO,KACP,IAAO,KACP,IAAO,KACP,GAAM,KACN,UAAW,MACX,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,WACP,WAAY,UACZ,WAAY,UACZ,GAAM,KACN,IAAO,KACP,GAAM,KACN,IAAO,KACP,IAAO,WACP,IAAO,KACP,GAAM,KACN,GAAM,QACN,IAAO,KACP,GAAM,WACN,IAAO,KACP,GAAM,KACN,IAAO,UACP,IAAO,WACP,WAAY,KACZ,IAAO,KACP,IAAO,KACP,GAAM,UACN,UAAW,UACX,QAAS,UACT,QAAS,UACT,UAAW,UACX,QAAS,UACT,GAAM,KACN,IAAO,KACP,QAAS,KACT,IAAO,KACP,GAAM,UACN,IAAO,KACP,GAAM,UACN,UAAW,MACX,GAAM,KACN,IAAO,KACP,GAAM,KACN,IAAO,KACP,IAAO,KACP,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,UAAW,KACX,GAAM,KACN,IAAO,KACP,IAAO,KACP,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KACP,SAAU,KACV,cAAe,KACf,GAAM,KACN,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KAEP,QAAS,KACT,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,IAAO,KA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","file":"InPageEdit.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","const funcName = 'InPageEdit';\r\nconst userLang = mw.config.get('wgUserLanguage');\r\nconst fallbacks = {\r\n  'ab': 'ru',\r\n  'ace': 'id',\r\n  'aln': 'sq',\r\n  'als': 'gsw',\r\n  'an': 'es',\r\n  'anp': 'hi',\r\n  'arn': 'es',\r\n  'arz': 'ar',\r\n  'av': 'ru',\r\n  'ay': 'es',\r\n  'ba': 'ru',\r\n  'bar': 'de',\r\n  'bat-smg': 'sgs',\r\n  'bcc': 'fa',\r\n  'be-x-old': 'be-tarask',\r\n  'bh': 'bho',\r\n  'bjn': 'id',\r\n  'bm': 'fr',\r\n  'bpy': 'bn',\r\n  'bqi': 'fa',\r\n  'bug': 'id',\r\n  'cbk-zam': 'es',\r\n  'ce': 'ru',\r\n  'ckb': 'ckb-arab',\r\n  'crh': 'crh-latn',\r\n  'crh-cyrl': 'ru',\r\n  'csb': 'pl',\r\n  'cv': 'ru',\r\n  'de-at': 'de',\r\n  'de-ch': 'de',\r\n  'de-formal': 'de',\r\n  'dsb': 'de',\r\n  'dtp': 'ms',\r\n  'eml': 'it',\r\n  'ff': 'fr',\r\n  'fiu-vro': 'vro',\r\n  'frc': 'fr',\r\n  'frp': 'fr',\r\n  'frr': 'de',\r\n  'fur': 'it',\r\n  'gag': 'tr',\r\n  'gan': 'gan-hant',\r\n  'gan-hans': 'zh-hans',\r\n  'gan-hant': 'zh-hant',\r\n  'gl': 'pt',\r\n  'glk': 'fa',\r\n  'gn': 'es',\r\n  'gsw': 'de',\r\n  'hif': 'hif-latn',\r\n  'hsb': 'de',\r\n  'ht': 'fr',\r\n  'ii': 'zh-cn',\r\n  'inh': 'ru',\r\n  'iu': 'ike-cans',\r\n  'jut': 'da',\r\n  'jv': 'id',\r\n  'kaa': 'kk-latn',\r\n  'kbd': 'kbd-cyrl',\r\n  'kbd-cyrl': 'ru',\r\n  'khw': 'ur',\r\n  'kiu': 'tr',\r\n  'kk': 'kk-cyrl',\r\n  'kk-arab': 'kk-cyrl',\r\n  'kk-cn': 'kk-arab',\r\n  'kk-kz': 'kk-cyrl',\r\n  'kk-latn': 'kk-cyrl',\r\n  'kk-tr': 'kk-latn',\r\n  'kl': 'da',\r\n  'koi': 'ru',\r\n  'ko-kp': 'ko',\r\n  'krc': 'ru',\r\n  'ks': 'ks-arab',\r\n  'ksh': 'de',\r\n  'ku': 'ku-latn',\r\n  'ku-arab': 'ckb',\r\n  'kv': 'ru',\r\n  'lad': 'es',\r\n  'lb': 'de',\r\n  'lbe': 'ru',\r\n  'lez': 'ru',\r\n  'li': 'nl',\r\n  'lij': 'it',\r\n  'liv': 'et',\r\n  'lmo': 'it',\r\n  'ln': 'fr',\r\n  'ltg': 'lv',\r\n  'lzz': 'tr',\r\n  'mai': 'hi',\r\n  'map-bms': 'jv',\r\n  'mg': 'fr',\r\n  'mhr': 'ru',\r\n  'min': 'id',\r\n  'mo': 'ro',\r\n  'mrj': 'ru',\r\n  'mwl': 'pt',\r\n  'myv': 'ru',\r\n  'mzn': 'fa',\r\n  'nah': 'es',\r\n  'nap': 'it',\r\n  'nds': 'de',\r\n  'nds-nl': 'nl',\r\n  'nl-informal': 'nl',\r\n  'no': 'nb',\r\n  'os': 'ru',\r\n  'pcd': 'fr',\r\n  'pdc': 'de',\r\n  'pdt': 'de',\r\n  'pfl': 'de',\r\n  'pms': 'it',\r\n  // 'pt': 'pt-br',\r\n  'pt-br': 'pt',\r\n  'qu': 'es',\r\n  'qug': 'qu',\r\n  'rgn': 'it',\r\n  'rmy': 'ro',\r\n  'rue': 'uk',\r\n  'ruq': 'ruq-latn',\r\n  'ruq-cyrl': 'mk',\r\n  'ruq-latn': 'ro',\r\n  'sa': 'hi',\r\n  'sah': 'ru',\r\n  'scn': 'it',\r\n  'sg': 'fr',\r\n  'sgs': 'lt',\r\n  'shi': 'ar',\r\n  'simple': 'en',\r\n  'sli': 'de',\r\n  'sr': 'sr-ec',\r\n  'srn': 'nl',\r\n  'stq': 'de',\r\n  'su': 'id',\r\n  'szl': 'pl',\r\n  'tcy': 'kn',\r\n  'tg': 'tg-cyrl',\r\n  'tt': 'tt-cyrl',\r\n  'tt-cyrl': 'ru',\r\n  'ty': 'fr',\r\n  'udm': 'ru',\r\n  'ug': 'ug-arab',\r\n  'uk': 'ru',\r\n  'vec': 'it',\r\n  'vep': 'et',\r\n  'vls': 'nl',\r\n  'vmf': 'de',\r\n  'vot': 'fi',\r\n  'vro': 'et',\r\n  'wa': 'fr',\r\n  'wo': 'fr',\r\n  'wuu': 'zh-hans',\r\n  'xal': 'ru',\r\n  'xmf': 'ka',\r\n  'yi': 'he',\r\n  'za': 'zh-hans',\r\n  'zea': 'nl',\r\n  'zh': 'zh-hans',\r\n  'zh-classical': 'lzh',\r\n  'zh-cn': 'zh-hans',\r\n  'zh-hant': 'zh-hans',\r\n  'zh-hk': 'zh-hant',\r\n  'zh-min-nan': 'nan',\r\n  'zh-mo': 'zh-hk',\r\n  'zh-my': 'zh-sg',\r\n  'zh-sg': 'zh-hans',\r\n  'zh-tw': 'zh-hant',\r\n  'zh-yue': 'yue'\r\n}\r\n\r\n/**\r\n * @function toObject\r\n * @param {String} data \r\n */\r\nfunction toObject(data) {\r\n  try {\r\n    return JSON.parse(data);\r\n  } catch (e) {\r\n    return {}\r\n  }\r\n}\r\n\r\n/**\r\n * Substitute arguments into the string, where arguments are represented\r\n * as $n where n > 0.\r\n *\r\n * @param message The message to substitute arguments into\r\n * @param arguments The arguments to substitute in.\r\n *\r\n * @return The resulting message.\r\n */\r\nfunction handleArgs(message, ...args) {\r\n  args.forEach(function (elem, index) {\r\n    var rgx = new RegExp('\\\\$' + (index + 1), 'g');\r\n    message = message.replace(rgx, elem);\r\n  });\r\n\r\n  return message;\r\n}\r\n\r\n/**\r\n * Generate a HTML link using the supplied parameters.\r\n *\r\n * @param href The href of the link which will be converted to\r\n *     '/wiki/href'.\r\n * @param text The text and title of the link. If this is not supplied, it\r\n *     will default to href.\r\n * @param hasProtocol True if the href parameter already includes the\r\n *     protocol (i.e. it begins with 'http://', 'https://', or '//').\r\n *\r\n * @return The generated link.\r\n */\r\nfunction makeLink(href, text, hasProtocol, blank) {\r\n  text = text || href;\r\n  href = hasProtocol ? href : mw.util.getUrl(href);\r\n\r\n  text = mw.html.escape(text);\r\n  href = mw.html.escape(href);\r\n\r\n  blank = blank ? 'target=\"_blank\"' : '';\r\n\r\n  return '<a href=\"' + href + '\" title=\"' + text + '\"' + blank + '>' + text + '</a>';\r\n}\r\n\r\n/*\r\n * Allow basic inline HTML tags in wikitext.does not support <a> as that's handled by the\r\n * wikitext links instead.\r\n *\r\n * Supports the following tags:\r\n * - <i>\r\n * - <b>\r\n * - <s>\r\n * - <br>\r\n * - <em>\r\n * - <strong>\r\n * - <span>\r\n *\r\n * Supports the following tag attributes:\r\n * - title\r\n * - style\r\n * - class\r\n *\r\n * @param html\r\n *\r\n * @return\r\n */\r\nfunction sanitiseHtml(html) {\r\n  var context = document.implementation.createHTMLDocument(''),\r\n    $html = $.parseHTML(html, /* document */ context, /* keepscripts */ false),\r\n    $div = $('<div>', context).append($html),\r\n    whitelistAttrs = [\r\n      'title',\r\n      'style',\r\n      'class'\r\n    ],\r\n    whitelistTags = [\r\n      'b',\r\n      'br',\r\n      'code',\r\n      'del',\r\n      'em',\r\n      'i',\r\n      's',\r\n      'strong',\r\n      'span',\r\n    ];\r\n\r\n  $div.find('*').each(function () {\r\n    var $this = $(this),\r\n      tagname = $this.prop('tagName').toLowerCase(),\r\n      attrs,\r\n      array,\r\n      style;\r\n\r\n    if (whitelistTags.indexOf(tagname) === -1) {\r\n      mw.log('[I18n-js] Disallowed tag in message: ' + tagname);\r\n      $this.remove();\r\n      return;\r\n    }\r\n\r\n    attrs = $this.prop('attributes');\r\n    array = Array.prototype.slice.call(attrs);\r\n\r\n    array.forEach(function (attr) {\r\n      if (whitelistAttrs.indexOf(attr.name) === -1) {\r\n        mw.log('[I18n-js] Disallowed attribute in message: ' + attr.name + ', tag: ' + tagname);\r\n        $this.removeAttr(attr.name);\r\n        return;\r\n      }\r\n\r\n      // make sure there's nothing nasty in style attributes\r\n      if (attr.name === 'style') {\r\n        style = $this.attr('style');\r\n\r\n        if (style.indexOf('url(') > -1) {\r\n          mw.log('[I18n-js] Disallowed url() in style attribute');\r\n          $this.removeAttr('style');\r\n\r\n          // https://phabricator.wikimedia.org/T208881\r\n        } else if (style.indexOf('var(') > -1) {\r\n          mw.log('[I18n-js] Disallowed var() in style attribute');\r\n          $this.removeAttr('style');\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  return $div.prop('innerHTML');\r\n}\r\n\r\n/*\r\n * Parse some basic wikitext into HTML. Also supports basic inline HTML tags.\r\n *\r\n * Will process:\r\n * - http/https\r\n * - [url text]\r\n * - [[pagename]]\r\n * - [[pagename|text]]\r\n * - {{PLURAL:count|singular|plural}}\r\n * - {{GENDER:gender|masculine|feminine|neutral}}\r\n *\r\n * @param message The message to process.\r\n *\r\n * @return The resulting string.\r\n */\r\nfunction parseWikitext(message) {\r\n  // [url text] -> [$1 $2]\r\n  var urlRgx = /\\[((?:https?:)?\\/\\/.+?) (.+?)\\]/g,\r\n    // [[pagename]] -> [[$1]]\r\n    simplePageRgx = /\\[\\[([^|]*?)\\]\\]/g,\r\n    // [[pagename|text]] -> [[$1|$2]]\r\n    pageWithTextRgx = /\\[\\[(.+?)\\|(.+?)\\]\\]/g,\r\n    // {{PLURAL:count|singular|plural}} -> {{PLURAL:$1|$2}}\r\n    pluralRgx = /\\{\\{PLURAL:(\\d+)\\|(.+?)\\}\\}/gi,\r\n    // {{GENDER:gender|masculine|feminine|neutral}} -> {{GENDER:$1|$2}}\r\n    genderRgx = /\\{\\{GENDER:([^|]+)\\|(.+?)\\}\\}/gi;\r\n\r\n  if (message.indexOf('<') > -1) {\r\n    message = sanitiseHtml(message);\r\n  }\r\n\r\n  return message\r\n    .replace(urlRgx, function (_match, href, text) {\r\n      return makeLink(href, text, true, true);\r\n    })\r\n    // .replace(httpRgx, function (_match, before, href, after) {\r\n    //   return before + makeLink(href, href, true, true) + after;\r\n    // })\r\n    .replace(simplePageRgx, function (_match, href) {\r\n      return makeLink(href);\r\n    })\r\n    .replace(pageWithTextRgx, function (_match, href, text) {\r\n      return makeLink(href, text);\r\n    })\r\n    .replace(pluralRgx, function (_match, count, forms) {\r\n      return mw.language.convertPlural(Number(count), forms.split('|'));\r\n    })\r\n    .replace(genderRgx, function (_match, gender, forms) {\r\n      return mw.language.gender(gender, forms.split('|'));\r\n    });\r\n}\r\n\r\n/**\r\n * @function parseMessage\r\n * @param {String} msg \r\n * @param  {...Sting} args \r\n */\r\nfunction parseMessage(msg, ...args) {\r\n  msg = handleArgs(msg, ...args);\r\n  msg = parseWikitext(msg);\r\n  return msg;\r\n}\r\n\r\n/**\r\n * @function rawMessage\r\n */\r\nfunction getMessage(lang, msgKey, ...args) {\r\n  const i18nCache = localStorage.getItem('i18n-cache-' + funcName + '-content') || '{}';\r\n\r\n  // qqx\r\n  if (lang === 'qqx') {\r\n    var after = '';\r\n    if (args.length > 0) {\r\n      after = ': ' + args.join(', ');\r\n    }\r\n    return `(${funcName.toLowerCase()}-${msgKey}${after})`;\r\n  }\r\n\r\n  // 获取 i18n \r\n  var cacheMessages = toObject(i18nCache);\r\n\r\n  // 查询本地覆写\r\n  var ipe = window.InPageEdit || {};\r\n  var overrides = ipe.i18n || {};\r\n  // InPageEdit.i18n.msgKey\r\n  if (overrides[msgKey]) {\r\n    return parseMessage(overrides[msgKey], ...args);\r\n  }\r\n  // InPageEdit.i18n.lang.msgKey\r\n  if (overrides[lang] && overrides[lang][msgKey]) {\r\n    return parseMessage(overrides[lang][msgKey], ...args);\r\n  }\r\n\r\n  // 查询用户语言\r\n  if (cacheMessages[lang] && cacheMessages[lang][msgKey]) {\r\n    return parseMessage(cacheMessages[lang][msgKey], ...args);\r\n  }\r\n\r\n  // 如果到了这一步，意味着消息不存在\r\n  if (lang === 'en') {\r\n    return `<${funcName}-${msgKey}>`;\r\n  }\r\n\r\n  // 转换用户语言后再试，例如 zh => zh-hans, zh-tw => zh-hant\r\n  lang = fallbacks[lang] || 'en';\r\n  return getMessage(lang, msgKey, ...args);\r\n\r\n}\r\n\r\n/**\r\n * @module _msg\r\n * @param {String} msgKey 消息的键\r\n * @param  {String} args 替代占位符($1, $2...)的内容，可以解析简单的wikitext\r\n */\r\nvar _msg = function (msgKey, ...args) {\r\n  return getMessage(userLang, msgKey, ...args);\r\n}\r\n\r\nmodule.exports = {\r\n  _msg\r\n}","/**\r\n * @module _elements 常用html元素\r\n */\r\nvar $br = '<br>',\r\n  $hr = '<hr>',\r\n  $progress = '<div class=\"ipe-progress\" style=\"width: 100%\"><div class=\"ipe-progress-bar\"></div></div>';\r\n\r\nmodule.exports = {\r\n  $br,\r\n  br: $br,\r\n  $hr,\r\n  hr: $hr,\r\n  $progress,\r\n  progress: $progress,\r\n}","var config = mw.config.get();\r\nvar api = require('./api.json');\r\n\r\n/**\r\n * @module _analysis 提交统计信息模块\r\n * @param {String} functionID 模块ID，例如 quick_edit\r\n */\r\nconst _analysis = function (functionID) {\r\n  if (InPageEdit.doNotCollectMyInfo === true) {\r\n    // console.info('[InPageEdit] 我们已不再收集您使用插件的信息。');\r\n    // return;\r\n  }\r\n  var submitdata = {\r\n    'action': 'submit',\r\n    'url': config.wgServer + config.wgArticlePath.replace('$1', ''),\r\n    'sitename': config.wgSiteName,\r\n    'username': config.wgUserName,\r\n    'function': functionID\r\n  }\r\n  $.ajax({\r\n    url: api.analysis,\r\n    data: submitdata,\r\n    type: 'post',\r\n    dataType: 'json'\r\n  }).done(function (data) {\r\n    console.log('[InPageEdit] Analysis response\\nStatus: ' + data.status + '\\nMessage: ' + data.msg);\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  _analysis\r\n}","/**\r\n * @returns {String} https://cdn.jsdelivr.net/... 结尾没有/\r\n */\r\nfunction getDir() {\r\n  var thisScript = document.currentScript.src;\r\n  var thisUrl = thisScript.split('/');\r\n  // 理论上入口文件位于 /dist/*.js\r\n  // 因此删掉最后两位路径\r\n  thisUrl.pop();\r\n  thisUrl.pop();\r\n  thisUrl = thisUrl.join('/');\r\n  return thisUrl;\r\n}\r\n\r\n/**\r\n * @constant {String} _dir CDN URL\r\n */\r\nconst _dir = getDir();\r\n\r\nmodule.exports = _dir;","const version = require('../package.json').version;\r\n\r\nmodule.exports = version;","var InPageEdit = window.InPageEdit || {};\r\n\r\nconst { _analysis } = require('./_analysis');\r\nconst { _msg } = require('./_msg');\r\nconst { $br, $hr } = require('./_elements');\r\n\r\nconst api = require('./api.json')\r\nconst version = require('./version');\r\n\r\n/**\r\n * @module preference 个人设置模块\r\n */\r\nvar preference = {\r\n  /**\r\n   * @name 预设值\r\n   * @return {object}\r\n   */\r\n  \"default\": {\r\n    doNotCollectMyInfo: false,\r\n    doNotShowLocalWarn: false,\r\n    editMinor: false,\r\n    editSummary: _msg('preference-summary-default'),\r\n    lockToolBox: false,\r\n    redLinkQuickEdit: true,\r\n    outSideClose: true,\r\n    watchList: Boolean(mw.user.options.get('watchdefault'))\r\n  },\r\n  /**\r\n   * @name 获取设置 \r\n   * @description 合并保存在用户页的设置以及localStorage的设置，有容错机制\r\n   * @param {string} setting 返回相应的设置，为空时返回全部设置\r\n   * @return {object|string}\r\n   */\r\n  get: function (setting) {\r\n    setting = setting || undefined;\r\n    var local = localStorage.getItem('InPageEditPreference') || '{}';\r\n    try {\r\n      local = JSON.parse(local);\r\n    } catch (e) {\r\n      local = {};\r\n    }\r\n    if (typeof InPageEdit.myPreference === 'object') {\r\n      local = $.extend({}, local, InPageEdit.myPreference);\r\n    }\r\n    var json = $.extend({}, preference.default, local);\r\n    if (typeof (setting) === 'string' && setting !== '') {\r\n      return json[setting] ? json[setting] : null;\r\n    } else {\r\n      return json;\r\n    }\r\n  },\r\n  /**\r\n   * @name 保存设置\r\n   * @param {Object|string} settingKey\r\n   * @param {any} settingValue\r\n   * @example 可以这样 preference.set({ key: 'value' }) 也可以 preference.set('key', 'value')\r\n   */\r\n  set: function (settingKey = {}, settingValue = undefined) {\r\n    var options = {};\r\n    if (typeof settingKey === 'string' && settingValue !== undefined) {\r\n      options[settingKey] = settingValue;\r\n    } else if (typeof settingKey === 'object') {\r\n      options = settingKey;\r\n    } else {\r\n      return;\r\n    }\r\n    options = $.extend({}, preference.get(), options);\r\n    options = JSON.stringify(options);\r\n    localStorage.setItem('InPageEditPreference', options);\r\n  },\r\n  /**\r\n   * @name 用户图形界面\r\n   * @description 打开可视化设置窗口\r\n   */\r\n  modal: function () {\r\n    // 防止多开设置页面\r\n    if ($('#ipe-preference-form').length > 0) return;\r\n\r\n    mw.hook('pluginPreference').fire();\r\n    preference.set();\r\n    var local = preference.get();\r\n    _analysis('plugin_setting');\r\n\r\n    ssi_modal.show({\r\n      outSideClose: false,\r\n      title: _msg('preference-title') + ' - ' + version,\r\n      content:\r\n        $('<section>', { id: 'ipe-preference-form', class: 'ipe-preference-form' }).append(\r\n          $('<h4>', { text: _msg('preference-editor-label') }),\r\n          $('<label>').append(\r\n            $('<input>', { id: 'outSideClose', type: 'checkbox' }).prop('checked', local.outSideClose),\r\n            $('<span>', { text: _msg('preference-outSideClose') })\r\n          ),\r\n          $br,\r\n          $('<label>').append(\r\n            $('<input>', { id: 'editMinor', type: 'checkbox' }).prop('checked', local.editMinor),\r\n            $('<span>', { text: _msg('preference-setMinor') })\r\n          ),\r\n          $br,\r\n          $('<h4>', { text: _msg('preference-summary-label') }),\r\n          $('<label>', { for: 'editSummary', style: 'padding-left: 0; font-size: small', html: _msg('preference-editSummary') }),\r\n          $br,\r\n          $('<input>', { id: 'editSummary', style: 'width: 96%', value: local.editSummary, placeholder: 'Edit via InPageEdit, yeah~' }),\r\n          $('<h4>', { text: _msg('preference-analysis-label') }),\r\n          $('<span>', { style: 'font-size: small; line-height: 0.9em', html: _msg('preference-analysis-view', `[${api.analysisUrl} ${api.analysisUrl}]`) }),\r\n          $('<h4>', { text: _msg('preference-about-label') }),\r\n          $('<button>', { class: 'btn btn-secondary', onclick: \"InPageEdit.about()\", text: _msg('preference-aboutAndHelp') }),\r\n          $('<button>', { class: 'btn btn-secondary', style: 'margin-left: 1em;', onclick: \"InPageEdit.versionInfo()\", text: _msg('preference-updatelog') }),\r\n          $('<a>', { href: 'https://ipe.miraheze.org/wiki/', target: '_blank', style: 'margin-left: 1em;' }).append(\r\n            $('<button>', { class: 'btn btn-secondary', text: _msg('preference-translate') })\r\n          ),\r\n          $('<a>', { href: 'https://discord.gg/VUVAh8w', target: '_blank', style: 'margin-left: 1em;' }).append(\r\n            $('<button>', { class: 'btn btn-secondary', text: _msg('preference-discord') })\r\n          ),\r\n          $hr,\r\n          $('<strong>', { style: 'font-size: small; line-height: 0.9em', text: _msg('preference-savelocal-label') }),\r\n          $br,\r\n          $('<span>', { style: 'font-size: small; line-height: 0.9em', text: _msg('preference-savelocal') }).append(\r\n            $('<a>', { href: 'javascript:;', id: 'ipeSaveLocalShow', text: _msg('preference-savelocal-btn') }).click(function () {\r\n              // 永久保存（本地用户页）\r\n              ssi_modal.dialog({\r\n                className: 'in-page-edit',\r\n                center: true,\r\n                title: _msg('preference-savelocal-popup-title'),\r\n                content: '<section id=\"ipeSaveLocal\">' + _msg('preference-savelocal-popup') + '<br/><textarea style=\"font-size: 12px; resize: none; width: 100%; height: 10em;\" readonly></textarea><br/>' + _msg('preference-savelocal-popup-notice') + '</section>',\r\n                okBtn: {\r\n                  className: 'btn btn-primary btn-single',\r\n                  label: _msg('ok')\r\n                }\r\n              });\r\n              $('#ipeSaveLocal textarea').val('/** InPageEdit Preferences **/\\nwindow.InPageEdit = window.InPageEdit || {}; // Keep this line\\nInPageEdit.myPreference = ' + JSON.stringify($.extend({}, preference.get(), $('#ipe-preference-form').data()), null, 2));\r\n            })\r\n          )\r\n        ),\r\n      sizeClass: 'dialog',\r\n      className: 'in-page-edit ipe-preference',\r\n      center: true,\r\n      buttons: [{\r\n        label: _msg('preference-reset'),\r\n        className: 'btn btn-danger',\r\n        method: function (a, modal) {\r\n          ssi_modal.confirm({\r\n            title: _msg('preference-reset-confirm-title'),\r\n            content: _msg('preference-reset-confirm'),\r\n            className: 'in-page-edit',\r\n            center: true,\r\n            okBtn: {\r\n              label: _msg('ok'),\r\n              className: 'btn btn-danger'\r\n            },\r\n            cancelBtn: {\r\n              label: _msg('cancel'),\r\n              className: 'btn'\r\n            }\r\n          }, (res) => {\r\n            if (res) {\r\n              preference.set(preference.default);\r\n              modal.close();\r\n            } else {\r\n              return false;\r\n            }\r\n          });\r\n        }\r\n      }, {\r\n        label: _msg('preference-save'),\r\n        className: 'btn btn-primary',\r\n        method: function (a, modal) {\r\n          preference.set($('#ipe-preference-form').data());\r\n          modal.close();\r\n        }\r\n      }\r\n      ],\r\n      onShow: function () {\r\n        function setData() {\r\n          if (this.type === 'checkbox') {\r\n            $('#ipe-preference-form').data(this.id, this.checked);\r\n          } else if (this.type === 'text') {\r\n            $('#ipe-preference-form').data(this.id, this.value);\r\n          }\r\n        }\r\n        $('#ipe-preference-form input').each(setData).change(setData);\r\n\r\n        if (typeof (InPageEdit.myPreference) !== 'undefined') {\r\n          $('#ipe-preference-form input, .ipe-preference .ssi-modalBtn').attr({ 'disabled': 'disabled' });\r\n          $('#ipe-preference-form').prepend(\r\n            $('<p>', { class: 'has-local-warn', style: 'padding-left: 8px; border-left: 6px solid orange; font-size: small;', html: _msg('preference-savelocal-popup-haslocal') })\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  preference\r\n}","var config = mw.config.get();\r\n\r\n/** \r\n * @module _hasRight 是否拥有权限\r\n * @param {String} right\r\n * @return {Boolean}\r\n */\r\nconst _hasRight = function (right) {\r\n  if (config.wgUserIsBlocked === true) {\r\n    return false;\r\n  }\r\n  if (mw.config.get('wgUserRights').indexOf(right) > -1) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  _hasRight\r\n}","var mwApi = new mw.Api();\r\nvar config = mw.config.get();\r\n\r\nconst { _analysis } = require('./_analysis');\r\nconst { _msg } = require('./_msg');\r\nconst { _hasRight } = require('./_hasRight');\r\n\r\nconst { $br, $progress } = require('./_elements');\r\n\r\nconst { findAndReplace } = require('./findAndReplace');\r\nconst { preference } = require('./preference');\r\nconst { progress } = require('./progress')\r\nconst { quickPreview } = require('./quickPreview');\r\nconst { quickDiff } = require('./quickDiff');\r\n\r\n/**\r\n * @module quickEdit 快速编辑模块\r\n * \r\n * @param {Object} options\r\n * @param {String} options.page edit page (default: wgPageName)\r\n * @param {Number} options.revision page rev ID\r\n * @param {Number} options.section edit section\r\n * @param {Boolean} options.reload if reload page after save successful (default: true)\r\n */\r\nvar quickEdit = function (options) {\r\n  /** 获取设定信息，设置缺省值 **/\r\n  options = options || {};\r\n  if (typeof options === 'string') {\r\n    options = {\r\n      page: options\r\n    }\r\n  }\r\n  var defaultOptions = {\r\n    page: config.wgPageName,\r\n    pageId: -1,\r\n    revision: null,\r\n    summaryRevision: '',\r\n    section: null,\r\n    editText: '',\r\n    editMinor: false,\r\n    editSummary: _msg('preference-summary-default'),\r\n    editNotice: '',\r\n    outSideClose: true,\r\n    jsonGet: {\r\n      action: 'parse',\r\n      page: options.page || config.wgPageName,\r\n      prop: 'wikitext|langlinks|categories|templates|images|sections',\r\n      format: 'json'\r\n    },\r\n    jsonPost: {},\r\n    pageDetail: {},\r\n    jumpTo: '',\r\n    reload: true\r\n  }\r\n\r\n  /** 获取用户设置 **/\r\n  var userPreference = preference.get();\r\n\r\n  /** 缓存时间戳 **/\r\n  var date = new Date(),\r\n    timestamp = date.getTime(),\r\n    now = date.toUTCString();\r\n\r\n  /** 将选项合并并标准化 **/\r\n  options = $.extend({}, defaultOptions, options, userPreference);\r\n  options.page = decodeURIComponent(options.page); // 解码网址 Unicode\r\n\r\n  _analysis('quick_edit');\r\n\r\n  if (options.revision !== null && options.revision !== '' && options.revision !== config.wgCurRevisionId) {\r\n    ssi_modal.notify('warning', {\r\n      className: 'in-page-edit',\r\n      content: _msg('notify-editing-history'),\r\n      title: _msg('notify-info')\r\n    });\r\n    delete options.jsonGet.page;\r\n    options.jsonGet.oldid = options.revision;\r\n    options.summaryRevision = '(' + _msg('editor-summary-rivision') + '[[Special:Diff/' + options.revision + ']])';\r\n  } else {\r\n    if (options.section !== null && options.section !== '') {\r\n      options.jsonGet.section = options.section;\r\n    }\r\n  }\r\n\r\n  // 模态框内部\r\n  var $modalTitle = $('<span>').append(\r\n    _msg('editor-title-editing') + ': <u class=\"editPage\">' + options.page.replace(/_/g, ' ') + '</u>'\r\n  );\r\n  var $editTools = $('<div>', { class: 'editTools' }).append(\r\n    $('<div>', { class: 'btnGroup' }).append(\r\n      $('<div>', { class: 'toolSelect' }).append(\r\n        $('<div>', { class: 'label', text: _msg('editor-edittool-header') }),\r\n        $('<ul>', { class: 'ul-list' }).append(\r\n          $('<li>', { class: 'editToolBtn', 'data-open': '\\n== ', 'data-middle': _msg('editor-edittool-header-text'), 'data-close': ' ==\\n', text: 'H2' }),\r\n          $('<li>', { class: 'editToolBtn', 'data-open': '\\n=== ', 'data-middle': _msg('editor-edittool-header-text'), 'data-close': ' ===\\n', text: 'H3' }),\r\n          $('<li>', { class: 'editToolBtn', 'data-open': '\\n==== ', 'data-middle': _msg('editor-edittool-header-text'), 'data-close': ' ====\\n', text: 'H4' }),\r\n          $('<li>', { class: 'editToolBtn', 'data-open': '\\n===== ', 'data-middle': _msg('editor-edittool-header-text'), 'data-close': ' =====\\n', text: 'H5' })\r\n        )\r\n      )\r\n    ),\r\n    $('<div>', { class: 'btnGroup' }).append(\r\n      $('<span>', { class: 'label', text: '格式' }),\r\n      $('<button>', { class: 'editToolBtn fa fa-bold btn', 'data-open': \"'''\", 'data-middle': _msg('editor-edittool-bold'), 'data-close': \"'''\" }),\r\n      $('<button>', { class: 'editToolBtn fa fa-italic btn', 'data-open': \"''\", 'data-middle': _msg('editor-edittool-italic'), 'data-close': \"''\" }),\r\n      $('<button>', { class: 'editToolBtn fa fa-list-ul btn', 'data-open': '\\n* ', 'data-middle': _msg('editor-edittool-list-bulleted'), 'data-close': '\\n' }),\r\n      $('<button>', { class: 'editToolBtn fa fa-list-ol btn', 'data-open': '\\n# ', 'data-middle': _msg('editor-edittool-list-numbered'), 'data-close': '\\n' }),\r\n      $('<button>', { class: 'editToolBtn fa fa-won btn', 'data-open': '<' + 'nowiki>', 'data-middle': _msg('editor-edittool-nowiki'), 'data-close': '</nowiki>' }),\r\n      $('<button>', { class: 'editToolBtn fa fa-level-down fa-rotate-90 btn', 'data-open': '<br>\\n', 'data-middle': '', 'data-close': '' })\r\n    ),\r\n    $('<div>', { class: 'btnGroup' }).append(\r\n      $('<span>', { class: 'label', text: '插入' }),\r\n      $('<button>', { class: 'editToolBtn fa fa-link btn', 'data-open': '[' + '[', 'data-middle': _msg('editor-edittool-internal-link'), 'data-close': ']]' }),\r\n      $('<button>', { class: 'editToolBtn fa fa-file-image-o btn', 'data-open': '[' + '[File:', 'data-middle': 'Example.png', 'data-close': '|thumb]]' }),\r\n      $('<button>', { class: 'editToolBtn btn', 'data-open': '\\n<' + 'gallery>\\n', 'data-middle': 'Example1.jpg|Description\\nExample2.png|Description', 'data-close': '\\n</gallery>\\n', html: '<span class=\"fa-stack\"><i class=\"fa fa-picture-o fa-stack-1x\"></i><i class=\"fa fa-picture-o fa-stack-1x\" style=\"left: 2px;top: 2px;text-shadow: 1px 1px 0 #fff;\"></i></span>' })\r\n    ),\r\n    $('<div>', { class: 'btnGroup extra', style: 'display: none' }).append(\r\n      $('<span>', { class: 'label', text: '自定义' })\r\n    ),\r\n    $('<div>', { class: 'btnGroup special-tools', style: 'float: right' }).append(\r\n      $('<button>', { class: 'btn fa fa-search' }).click(function () {\r\n        findAndReplace($('.ipe-editor.timestamp-' + timestamp + ' .editArea'));\r\n      })\r\n    )\r\n  );\r\n  var $editArea = $('<textarea>', { class: 'editArea', style: 'margin-top: 0;' });\r\n  var $optionsLabel = $('<div>', { class: 'editOptionsLabel hideBeforeLoaded' }).append(\r\n    $('<aside>', { class: 'detailArea' }).append(\r\n      $('<label>', { class: 'detailToggle', text: _msg('editor-detail-button-toggle') }),\r\n      $('<div>', { class: 'detailBtnGroup' }).append(\r\n        $('<a>', { href: 'javascript:;', class: 'detailBtn', id: 'showTemplates', text: _msg('editor-detail-button-templates') }),\r\n        ' | ',\r\n        $('<a>', { href: 'javascript:;', class: 'detailBtn', id: 'showImages', text: _msg('editor-detail-button-images') })\r\n      )\r\n    ),\r\n    // 摘要&小编辑\r\n    $('<label>', { for: 'editSummary', text: _msg('editSummary') }),\r\n    $br,\r\n    $('<input>', { class: 'editSummary', id: 'editSummary', placeholder: 'Edit via InPageEdit~', value: options.editSummary.replace(/\\$oldid/ig, options.summaryRevision) }),\r\n    $br,\r\n    $('<label>').append(\r\n      $('<input>', { type: 'checkbox', class: 'editMinor', id: 'editMinor', checked: options.editMinor }),\r\n      $('<span>', { text: _msg('markAsMinor') })\r\n    ),\r\n    $br,\r\n    $('<label>').append(\r\n      $('<input>', { type: 'checkbox', class: 'reloadPage', id: 'reloadPage', checked: options.reload }),\r\n      $('<span>', { text: _msg('editor-reload-page') })\r\n    )\r\n  );\r\n  var $modalContent = $('<div>').append(\r\n    $progress,\r\n    $('<section>', { class: 'hideBeforeLoaded' }).append(\r\n      // 编辑工具条\r\n      $editTools,\r\n      // 编辑框\r\n      $editArea\r\n    )\r\n  );\r\n\r\n  // Debug\r\n  console.time('[InPageEdit] 获取页面源代码');\r\n  console.info('[InPageEdit] QuickEdit start with options:');\r\n  console.table(options);\r\n\r\n  // 显示主窗口\r\n  ssi_modal.show({\r\n    title: $modalTitle,\r\n    content: $modalContent,\r\n    outSideClose: options.outSideClose,\r\n    className: 'in-page-edit ipe-editor timestamp-' + timestamp,\r\n    sizeClass: 'large',\r\n\r\n    /* 按钮 */\r\n    buttons: [{\r\n      label: _msg('editor-button-save'),\r\n      className: 'btn btn-primary leftBtn hideBeforeLoaded save-btn',\r\n      method(e, modal) {\r\n        ssi_modal.confirm({\r\n          className: 'in-page-edit',\r\n          center: true,\r\n          content: _msg('editor-confirm-save'),\r\n          okBtn: {\r\n            className: 'btn btn-primary',\r\n            label: _msg('confirm')\r\n          },\r\n          cancelBtn: {\r\n            className: 'btn btn-secondary',\r\n            label: _msg('cancel')\r\n          },\r\n        },\r\n          function (result) {\r\n            if (result) {\r\n              var text = $editArea.val(),\r\n                minor = $optionsLabel.find('.editMinor').prop('checked'),\r\n                section = options.section,\r\n                summary = $optionsLabel.find('.editSummary').val();\r\n              postArticle({\r\n                text: text,\r\n                page: options.page,\r\n                minor: minor,\r\n                section: section,\r\n                summary: summary\r\n              }, modal);\r\n            }\r\n          });\r\n      }\r\n    }, {\r\n      label: _msg('editor-button-preview'),\r\n      className: 'btn btn-secondary leftBtn hideBeforeLoaded',\r\n      method() {\r\n        _analysis('preview_edit');\r\n        var text = $editArea.val();\r\n        quickPreview({\r\n          title: options.page,\r\n          text: text,\r\n          pst: true\r\n        });\r\n      }\r\n    }, {\r\n      label: _msg('editor-button-diff'),\r\n      className: 'btn btn-secondary leftBtn hideBeforeLoaded diff-btn'\r\n    }, {\r\n      label: _msg('cancel'),\r\n      className: 'btn btn-danger',\r\n      method(e, modal) {\r\n        modal.close();\r\n      }\r\n    }\r\n    ],\r\n\r\n    /* 预加载 */\r\n    beforeShow() {\r\n      // 设置样式\r\n      $modalContent.find('.hideBeforeLoaded').hide();\r\n      $optionsLabel.hide();\r\n      $modalContent.find('.ipe-progress').css('margin', Number($(window).height() / 3 - 50) + 'px 0');\r\n      $editArea.css('height', $(window).height() / 3 * 2 - 100);\r\n      $('.ipe-editor.timestamp-' + timestamp + ' .ssi-buttons').prepend($optionsLabel);\r\n      $('.ipe-editor.timestamp-' + timestamp + ' .leftBtn').appendTo('.ipe-editor.timestamp-' + timestamp + ' .ssi-leftButtons');\r\n      $('.ipe-editor.timestamp-' + timestamp + ' .ssi-modalTitle').append(\r\n        $('<a>', {\r\n          class: 'showEditNotice',\r\n          href: 'javascript:void(0);',\r\n          html: '<i class=\"fa fa-info-circle\"></i> ' + _msg('editor-has-editNotice'),\r\n          style: 'display: none;'\r\n        }).click(function () {\r\n          ssi_modal.show({\r\n            className: 'in-page-edit',\r\n            center: true,\r\n            title: _msg('editor-title-editNotice'),\r\n            content: '<section class=\"editNotice\">' + $modalContent.data('editNotice') + '</section>'\r\n          });\r\n        })\r\n      );\r\n\r\n      /** Edit-Tool 扩展 **/\r\n      function insertText(strings, obj) {\r\n        var textarea = obj || $editArea[0],\r\n          start = textarea.selectionStart,\r\n          stop = textarea.selectionEnd,\r\n          selectedText = textarea.value.slice(start, stop);\r\n        textarea.value =\r\n          textarea.value.slice(0, start) +\r\n          (strings.open || '') +\r\n          (selectedText || strings.middle || '') +\r\n          (strings.close || '') +\r\n          textarea.value.slice(stop);\r\n        var selectStart = start + (strings.open.length || 0);\r\n        textarea.setSelectionRange(selectStart, selectStart + (selectedText.length || strings.middle.length || 0));\r\n        textarea.focus();\r\n      }\r\n      // 添加按钮\r\n      function addBtn(open, middle, close, icon) {\r\n        open = open || '';\r\n        middle = middle || '';\r\n        close = close || '';\r\n        icon = 'fa-' + icon || 'fa-wrench';\r\n        $modalContent.find('.btnGroup.extra').append(\r\n          $('<button>', { class: 'editToolBtn btn', 'data-open': open, 'data-middle': middle, 'data-close': close, html: `<i class=\"fa ${icon}\"></i>` })\r\n        );\r\n      }\r\n      // 用户自定义按钮\r\n      if (InPageEdit.buttons) {\r\n        var btns = InPageEdit.buttons;\r\n        $editTools.find('.btnGroup.extra').show();\r\n\r\n        for (var i = 0; i < btns.length; i++) {\r\n          var btn = btns[i];\r\n          addBtn(btn.open, btn.middle, btn.close, btn.text);\r\n        }\r\n      }\r\n      $editTools.find('.editToolBtn').click(function (e) {\r\n        e.preventDefault();\r\n        var $this = $(this),\r\n          $open = $this.attr('data-open') || '',\r\n          $middle = $this.attr('data-middle') || '',\r\n          $close = $this.attr('data-close') || '';\r\n        insertText({\r\n          open: $open,\r\n          middle: $middle,\r\n          close: $close\r\n        }, $editArea[0]);\r\n      });\r\n    },\r\n    /**\r\n  * @event onShow\r\n  * @description 模态框显示后\r\n  */\r\n    onShow() {\r\n      mw.hook('InPageEdit.quickEdit').fire({\r\n        $modalTitle,\r\n        $modalContent,\r\n        $editArea,\r\n        $editTools,\r\n        $optionsLabel\r\n      });\r\n      // 绑定事件，在尝试离开页面时提示\r\n      $('.ipe-editor.timestamp-' + timestamp + ' .editArea').change(function () {\r\n        $(this).attr('data-modifiled', 'true');\r\n        $(window).bind('beforeunload', function () {\r\n          return _msg('window-leave-confirm');\r\n        });\r\n      });\r\n      // 获取权限\r\n      if (!_hasRight('edit')) {\r\n        ssi_modal.notify('dialog', {\r\n          className: 'in-page-edit',\r\n          position: 'center bottom',\r\n          title: _msg('notify-no-right'),\r\n          content: _msg('editor-no-right'),\r\n          okBtn: {\r\n            label: _msg('ok'),\r\n            className: 'btn btn-primary',\r\n            method(e, modal) {\r\n              modal.close();\r\n            }\r\n          }\r\n        });\r\n        $('.ipe-editor.timestamp-' + timestamp + ' .save-btn').addClass('btn-danger');\r\n      }\r\n\r\n      // 解析页面内容\r\n      mwApi.get(options.jsonGet).done(function (data) {\r\n        console.timeEnd('[InPageEdit] 获取页面源代码');\r\n        contentDone(data);\r\n      }).fail(function (a, b, errorThrown) {\r\n        console.timeEnd('[InPageEdit] 获取页面源代码');\r\n        console.warn('[InPageEdit]警告：无法获取页面内容');\r\n        var data = errorThrown;\r\n        contentDone(data);\r\n      });\r\n\r\n      // 页面内容获取完毕，后续工作\r\n      function contentDone(data) {\r\n        options.pageDetail = data;\r\n\r\n        if (data.error) {\r\n          console.warn('[InPageEdit]警告：无法获取页面内容');\r\n          options.editText = '<!-- ' + data.error.info + ' -->';\r\n          options.pageId = -1;\r\n          $optionsLabel.find('.detailArea').hide();\r\n        } else {\r\n          options.editText = data.parse.wikitext['*'];\r\n          options.pageId = data.parse.pageid;\r\n        }\r\n        // 设定一堆子样式\r\n        $modalContent.find('.ipe-progress').hide();\r\n        $modalContent.find('.hideBeforeLoaded').fadeIn(500);\r\n        $optionsLabel.show();\r\n        $editArea.val(options.editText + '\\n');\r\n\r\n        var summaryVal;\r\n        if (options.section !== null) {\r\n          summaryVal = $optionsLabel.find('.editSummary').val();\r\n          summaryVal = summaryVal.replace(/\\$section/ig, '/* ' + data.parse.sections[0].line + ' */');\r\n          $optionsLabel.find('.editSummary').val(summaryVal);\r\n          $modalTitle.find('.editPage').after('<span class=\"editSection\">→' + data.parse.sections[0].line + '</span>');\r\n          options.jumpTo = '#' + data.parse.sections[0].anchor;\r\n        } else {\r\n          summaryVal = $optionsLabel.find('.editSummary').val();\r\n          summaryVal = summaryVal.replace(/\\$section/ig, '');\r\n          $optionsLabel.find('.editSummary').val(summaryVal);\r\n          options.jumpTo = '';\r\n        }\r\n        if (options.revision !== null && options.revision !== '' && options.revision !== config.wgCurRevisionId) {\r\n          $modalTitle.find('.editPage').after('<span class=\"editRevision\">(' + _msg('editor-title-editRevision') + '：' + options.revision + ')</span>');\r\n          $('.ipe-editor.timestamp-' + timestamp + ' .diff-btn').click(function () {\r\n            _analysis('quick_diff_edit');\r\n            var text = $editArea.val();\r\n            var diffJson = {\r\n              fromrev: options.revision,\r\n              totext: text,\r\n              hideBtn: true,\r\n              pageName: options.page,\r\n              isPreview: true\r\n            }\r\n            if (options.section) {\r\n              diffJson.fromsection = options.section;\r\n            }\r\n            quickDiff(diffJson);\r\n          });\r\n        } else {\r\n          $('.ipe-editor.timestamp-' + timestamp + ' .diff-btn').attr('disabled', true);\r\n        }\r\n\r\n        // 获取页面基础信息\r\n        console.time('[InPageEdit] 获取页面基础信息');\r\n        var queryJson = {\r\n          action: 'query',\r\n          prop: 'revisions|info',\r\n          inprop: 'protection',\r\n          format: 'json'\r\n        }\r\n        if (options.pageId !== -1) {\r\n          queryJson.pageids = options.pageId;\r\n        } else {\r\n          queryJson.titles = options.page;\r\n        }\r\n        mwApi.get(queryJson).done(function (data) {\r\n          console.info('[InPageEdit] 获取页面基础信息成功');\r\n          console.timeEnd('[InPageEdit] 获取页面基础信息');\r\n          // 记录页面最后编辑时间，防止编辑冲突\r\n          $modalContent.data('basetimestamp', data['query']['pages'][options.pageId].revisions ? data['query']['pages'][options.pageId]['revisions'][0]['timestamp'] : now);\r\n          queryDone(data);\r\n        }).fail(function (a, b, errorThrown) {\r\n          var data = errorThrown;\r\n          console.timeEnd('[InPageEdit] 获取页面基础信息');\r\n          console.warn('[InPageEdit] 获取页面基础信息失败');\r\n          $modalContent.data('basetimestamp', now);\r\n          queryDone(data);\r\n        });\r\n\r\n        /** 页面保护等级和编辑提示等 **/\r\n        function queryDone(data) {\r\n          options.namespace = data.query.pages[options.pageId].ns; // 名字空间ID\r\n          options.protection = data.query.pages[options.pageId]['protection'] || []; // 保护等级\r\n          if (data.query.pages[options.pageId].revisions) {\r\n            options.revision = data.query.pages[options.pageId]['revisions'][0]['revid']; // 版本号\r\n          }\r\n\r\n          // 使页面名标准化\r\n          options.page = data.query.pages[options.pageId].title;\r\n          $modalTitle.find('.editPage').text(options.page);\r\n\r\n          if (options.revision) {\r\n            $('.ipe-editor.timestamp-' + timestamp + ' .diff-btn').attr('disabled', false).click(function () {\r\n              _analysis('quick_diff_edit');\r\n              var text = $editArea.val();\r\n              var diffJson = {\r\n                fromrev: options.revision,\r\n                totext: text,\r\n                hideBtn: true,\r\n                pageName: options.page,\r\n                isPreview: true\r\n              }\r\n              if (options.section) {\r\n                diffJson.fromsection = options.section;\r\n              }\r\n              quickDiff(diffJson);\r\n            })\r\n          }\r\n\r\n          // 页面是否被保护\r\n          if (options.protection.length > 0) {\r\n            for (var i = 0; i < options.protection.length; i++) {\r\n              if (options.protection[i].type === 'edit') {\r\n                if (\r\n                  (options.protection[i].level === 'autoconfirmed' && !_hasRight('autoconfirmed')) ||\r\n                  (options.protection[i].level === 'sysop' && !_hasRight('editprotected')) ||\r\n                  (config.wgNamespaceNumber === 8 && !_hasRight('editinterface'))\r\n                ) {\r\n                  ssi_modal.notify('dialog', {\r\n                    className: 'in-page-edit',\r\n                    position: 'center bottom',\r\n                    title: _msg('notify-no-right'),\r\n                    content: _msg('editor-no-right'),\r\n                    okBtn: {\r\n                      label: _msg('ok'),\r\n                      className: 'btn btn-primary',\r\n                      method(e, modal) {\r\n                        modal.close();\r\n                      }\r\n                    }\r\n                  });\r\n                  $('.ipe-editor.timestamp-' + timestamp + ' .save-btn').addClass('btn-danger');\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          // 获取编辑提示\r\n          var namespaceNoticePage = 'Editnotice-' + options.namespace,\r\n            pageNoticePage = namespaceNoticePage + '-' +\r\n              options.page\r\n                .replace(/_/g, ' ') // 将页面名里的 _ 转换为空格\r\n                .replace(config.wgFormattedNamespaces[options.namespace] + ':', ''); // 去掉名字空间\r\n\r\n          mwApi.get({\r\n            action: 'query',\r\n            meta: 'allmessages',\r\n            ammessages: namespaceNoticePage + '|' + pageNoticePage\r\n          }).done(function (data) {\r\n            var wikitextNs = data.query.allmessages[0]['*'] || '',\r\n              wikitextPage = data.query.allmessages[1]['*'] || '';\r\n            if (wikitextNs === '' && wikitextPage === '') return; // 没有编辑提示\r\n            // 将编辑提示解析为 html\r\n            mwApi.post({\r\n              action: 'parse',\r\n              title: options.page,\r\n              contentmodel: 'wikitext',\r\n              preview: true,\r\n              text: wikitextPage + '\\n' + wikitextNs\r\n            }).done(function (data) {\r\n              options.editNotice = data.parse.text['*'];\r\n              var notice = $modalContent.data('editNotice') || '';\r\n              notice += '\\n' + options.editNotice;\r\n              $modalContent.data('editNotice', notice);\r\n              $modalContent.find('.showEditNotice').show();\r\n            });\r\n          });\r\n\r\n        }\r\n      }\r\n    },\r\n\r\n    /* 确认是否取消 */\r\n    beforeClose(modal) {\r\n      if ($editArea.attr('data-modifiled') !== 'true') {\r\n        close();\r\n        return;\r\n      } else if ($editArea.attr('data-confirmclose') === 'true') {\r\n        closeNoReload();\r\n        return;\r\n      }\r\n      ssi_modal.confirm({\r\n        className: 'in-page-edit',\r\n        center: true,\r\n        content: _msg('editor-leave-confirm'),\r\n        okBtn: {\r\n          className: 'btn btn-danger',\r\n          label: _msg('confirm')\r\n        },\r\n        cancelBtn: {\r\n          className: 'btn btn-secondary',\r\n          label: _msg('cancel')\r\n        }\r\n      },\r\n        function (result) {\r\n          if (result === true) {\r\n            close();\r\n          }\r\n        });\r\n      function close() {\r\n        $(window).unbind('beforeunload');\r\n        modal.options.keepContent = false;\r\n        modal.options.beforeClose = '';\r\n        modal.close();\r\n        ssi_modal.notify('info', {\r\n          className: 'in-page-edit',\r\n          position: 'right top',\r\n          title: _msg('cancel'),\r\n          content: _msg('notify-no-change')\r\n        });\r\n      }\r\n      function closeNoReload() {\r\n        $(window).unbind('beforeunload');\r\n        modal.options.keepContent = false;\r\n        modal.options.beforeClose = '';\r\n        modal.close();\r\n      }\r\n      return false;\r\n    }\r\n  });\r\n\r\n  // 页面详情模块\r\n  $optionsLabel.find('.detailBtnGroup .detailBtn').click(function () {\r\n    _analysis('quick_edit_pagedetail');\r\n    var $this = $(this),\r\n      id = $this.attr('id'),\r\n      content = $('<ul>');\r\n    switch (id) {\r\n      case 'showTemplates':\r\n        var templates = options.pageDetail.parse.templates,\r\n          templateName;\r\n        for (let i = 0; i < templates.length; i++) {\r\n          templateName = templates[i]['*'];\r\n          $('<li>').append(\r\n            $('<a>', { href: mw.util.getUrl(templateName), target: '_blank', text: templateName }),\r\n            ' (',\r\n            $('<a>', { href: 'javascript:;', text: _msg('quick-edit'), class: 'quickEditTemplate', 'data-template-name': templateName }),\r\n            ')'\r\n          ).appendTo(content);\r\n        }\r\n        ssi_modal.show({\r\n          className: 'in-page-edit quick-edit-detail',\r\n          sizeClass: 'dialog',\r\n          title: _msg('editor-detail-title-templates'),\r\n          content: content\r\n        });\r\n        break;\r\n      case 'showImages':\r\n        var images = options.pageDetail.parse.images,\r\n          imageName;\r\n        for (let i = 0; i < images.length; i++) {\r\n          imageName = images[i];\r\n          $('<li>').append(\r\n            $('<a>', { href: mw.util.getUrl('File:' + imageName), target: '_balnk', text: imageName }),\r\n            ' (',\r\n            $('<a>', { href: 'javascript:;', class: 'quickViewImage', text: _msg('editor-detail-images-quickview'), 'data-image-name': imageName }),\r\n            ' | ',\r\n            $('<a>', { href: config.wgScript + '?title=Special:Upload&wpDestFile=' + imageName + '&wpForReUpload=1', target: '_balnk', text: _msg('editor-detail-images-upload') }),\r\n            ')'\r\n          ).appendTo(content);\r\n        }\r\n        ssi_modal.show({\r\n          className: 'in-page-edit quick-edit-detail',\r\n          sizeClass: 'dialog',\r\n          title: _msg('editor-detail-title-images'),\r\n          content\r\n        });\r\n        break;\r\n    }\r\n    $('.in-page-edit.quick-edit-detail .quickEditTemplate').click(function () {\r\n      _analysis('quick_edit_pagedetail_edit_template');\r\n      var $this = $(this);\r\n      var page = $this.attr('data-template-name');\r\n      quickEdit({\r\n        page\r\n      });\r\n    });\r\n    $('.in-page-edit.quick-edit-detail .quickViewImage').click(function () {\r\n      _analysis('quick_edit_pagedetail_view_image');\r\n      var $this = $(this);\r\n      var imageName = $this.attr('data-image-name');\r\n      ssi_modal.show({\r\n        className: 'in-page-edit quick-view-image',\r\n        center: true,\r\n        title: imageName.replace(/_/g, ' '),\r\n        content: $('<center>', { id: 'imageLayer' }).append(\r\n          $progress\r\n        ),\r\n        buttons: [{\r\n          label: _msg('editor-detail-images-upload'),\r\n          className: 'btn btn-primary',\r\n          method() {\r\n            window.open(config.wgScript + '?title=Special:Upload&wpDestFile=' + imageName + '&wpForReUpload=1');\r\n          }\r\n        }, {\r\n          label: _msg('close'),\r\n          className: 'btn btn-secondary',\r\n          method(a, modal) { modal.close() }\r\n        }],\r\n        onShow() {\r\n          mwApi.get({\r\n            action: 'query',\r\n            format: 'json',\r\n            prop: 'imageinfo',\r\n            titles: 'File:' + imageName.replace(/file:/g, ''),\r\n            iiprop: 'url'\r\n          }).done(function (data) {\r\n            $('.quick-view-image .ipe-progress').hide();\r\n            $('.quick-view-image #imageLayer').append(\r\n              $('<img>', { src: data.query.pages['-1'].imageinfo[0].url, class: 'loading', style: 'max-width: 80%; max-height: 60vh' })\r\n            );\r\n            $('.quick-view-image #imageLayer img').load(function () {\r\n              $(this).removeClass('loading');\r\n            });\r\n          })\r\n        }\r\n      });\r\n    });\r\n  });\r\n\r\n  // 发布编辑模块\r\n  function postArticle({\r\n    text,\r\n    page,\r\n    minor,\r\n    summary,\r\n    section\r\n  }, modal) {\r\n    _analysis('quick_edit_save');\r\n    progress(_msg('editor-title-saving'));\r\n    options.jsonPost = {\r\n      action: 'edit',\r\n      basetimestamp: $modalContent.data('basetimestamp'),\r\n      starttimestamp: now,\r\n      text,\r\n      title: page,\r\n      minor,\r\n      summary,\r\n      errorformat: 'plaintext'\r\n    }\r\n    if (section !== undefined && section !== '' && section !== null) {\r\n      options.jsonPost.section = section;\r\n      delete options.jsonPost.basetimestamp;\r\n    }\r\n\r\n    mwApi.postWithToken('csrf', options.jsonPost).done(saveSuccess).fail(saveError);\r\n\r\n    // 保存正常\r\n    function saveSuccess(data, feedback, errorThrown) {\r\n      if (data.edit.result === 'Success') {\r\n        progress(true);\r\n        // 是否重载页面\r\n        if ($optionsLabel.find('.reloadPage').prop('checked')) {\r\n          var content;\r\n          $(window).unbind('beforeunload');\r\n          content = _msg('notify-save-success');\r\n          setTimeout(function () {\r\n            if (page === config.wgPageName) {\r\n              window.location = mw.util.getUrl(page) + options.jumpTo;\r\n              window.location.reload();\r\n            } else {\r\n              window.location.reload();\r\n            }\r\n          }, 500);\r\n        } else {\r\n          console.info('[InPageEdit] 将不会重载页面！');\r\n          content = _msg('notify-save-success-noreload');\r\n          setTimeout(function () {\r\n            progress(false);\r\n            $editArea.attr('data-confirmclose', 'true');\r\n            modal.close();\r\n          }, 1500);\r\n        }\r\n\r\n        ssi_modal.notify('success', {\r\n          className: 'in-page-edit',\r\n          position: 'right top',\r\n          title: _msg('notify-success'),\r\n          content\r\n        });\r\n      } else {\r\n        saveError(data, feedback, errorThrown)\r\n      }\r\n    }\r\n\r\n    // 保存失败\r\n    function saveError(errorCode, feedback, errorThrown) {\r\n      progress(false);\r\n      var data = errorThrown || errorCode; // 规范错误代码\r\n      var errorInfo,\r\n        errorMore = '';\r\n      if (data.errors !== undefined) {\r\n        errorCode = data.errors[0].code;\r\n        errorInfo = data.errors[0]['*'];\r\n        errorMore = '';\r\n      } else if (data.edit.result !== 'Success') {\r\n        errorCode = data.edit.code || 'Unknown';\r\n        errorInfo = data.edit.info || 'Reason unknown.';\r\n        errorMore = data.edit.warning || '';\r\n      } else {\r\n        errorCode = 'unknown';\r\n        errorInfo = 'Reason unknown.';\r\n        errorMore = 'Please contact plug-in author or try again.'\r\n      }\r\n      ssi_modal.show({\r\n        className: 'in-page-edit',\r\n        sizeClass: 'dialog',\r\n        center: true,\r\n        title: _msg('editor-save-error'),\r\n        content: errorInfo + '<hr style=\"clear: both\" />' + errorMore\r\n      });\r\n      ssi_modal.notify('error', {\r\n        className: 'in-page-edit',\r\n        position: 'right top',\r\n        closeAfter: {\r\n          time: 15\r\n        },\r\n        title: _msg('notify-error'),\r\n        content: _msg('editor-save-error') + '：<code>' + errorCode + '</code>'\r\n      });\r\n\r\n      console.error('[InPageEdit] Submit failed: \\nCode: ' + errorCode);\r\n      return;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  quickEdit\r\n}","const { _msg } = require('./_msg');\r\n\r\nconst { $progress } = require('./_elements.js');\r\n\r\n/**\r\n * @module progress 载入中模块\r\n * @param {Boolean|String} title\r\n * @default \"Loading...\"\r\n * @returns\r\n * - true: Mark top progress box as done\r\n * - false: Close top progress box\r\n * - String: Show new progress box with title\r\n */\r\nvar progress = function (title) {\r\n  if (title === true) {\r\n    $('.in-page-edit.loadingbox .ssi-modalTitle').html(_msg('done'));\r\n    $('.in-page-edit.loadingbox .ipe-progress').addClass('done');\r\n  } else if (title === false) {\r\n    if ($('.in-page-edit.loadingbox').length > 0) {\r\n      $('.in-page-edit.loadingbox').appendTo('body');\r\n      ssi_modal.close();\r\n    }\r\n  } else {\r\n    if ($('.in-page-edit.loadingbox').length > 0) return;\r\n    if (typeof title === 'undefined') {\r\n      title = 'Loading...'\r\n    }\r\n    ssi_modal.show({\r\n      title: title,\r\n      content: $progress,\r\n      className: 'in-page-edit loadingbox',\r\n      center: true,\r\n      sizeClass: 'dialog',\r\n      closeIcon: false,\r\n      outSideClose: false\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  progress\r\n}","var mwApi = new mw.Api();\r\nvar config = mw.config.get();\r\n\r\nconst { _analysis } = require('./_analysis');\r\nconst { _msg } = require('./_msg');\r\n\r\nconst { articleLink } = require('./articleLink');\r\nconst { $br, $progress } = require('./_elements');\r\n\r\n/**\r\n * @module quickDiff 快速页面差异模块\r\n * @param {Object} param standard MediaWiki API params\r\n */\r\nvar quickDiff = function (param) {\r\n  mw.hook('InPageEdit.quickDiff').fire();\r\n  _analysis('quick_diff');\r\n  if ($('[href*=\"mediawiki.diff.styles\"]').length < 1) {\r\n    mw.loader.load(mw.util.wikiScript('load') + '?modules=mediawiki.legacy.shared|mediawiki.diff.styles&only=styles', 'text/css');\r\n  }\r\n  var $modalTitle,\r\n    $diffArea,\r\n    $loading;\r\n  if ($('.quick-diff').length > 0) {\r\n    console.info('[InPageEdit] Quick diff 正在加载新内容');\r\n    $modalTitle = $('.quick-diff .pageName');\r\n    $diffArea = $('.quick-diff .diffArea');\r\n    $loading = $('.quick-diff .ipe-progress');\r\n    $modalTitle.text(_msg('diff-loading'));\r\n    $diffArea.hide();\r\n    $('.quick-diff').appendTo('body');\r\n  } else {\r\n    $modalTitle = $('<span>', { class: 'pageName', text: _msg('diff-loading') });\r\n    $diffArea = $('<div>', { class: 'diffArea', style: 'display: none' });\r\n    $loading = $($progress);\r\n\r\n    ssi_modal.show({\r\n      className: 'in-page-edit quick-diff',\r\n      sizeClass: 'large',\r\n      fixedHeight: true,\r\n      fitScreen: true,\r\n      title: $modalTitle,\r\n      content: $('<div>').append($loading, $diffArea),\r\n      buttons: [{\r\n        label: _msg('diff-button-todiffpage'),\r\n        className: 'btn btn-secondary toDiffPage'\r\n      }]\r\n    });\r\n  }\r\n  $loading.show().css('margin-top', $('.quick-diff .ssi-modalContent').height() / 2);\r\n  $('.quick-diff .toDiffPage').unbind();\r\n  param.action = 'compare';\r\n  param.prop = 'diff|diffsize|rel|ids|title|user|comment|parsedcomment|size';\r\n  param.format = 'json';\r\n  if (param.totext) {\r\n    param.topst = true;\r\n  } else if (param.fromtext) {\r\n    param.frompst = true;\r\n  }\r\n  mwApi.post(param).done(function (data) {\r\n    var diffTable = data.compare['*'];\r\n    var toTitle;\r\n    $loading.hide();\r\n    if (param.pageName === undefined) {\r\n      toTitle = data.compare.totitle;\r\n    } else {\r\n      toTitle = param.pageName;\r\n    }\r\n    var userLink = function (user) {\r\n      return '<a class=\"diff-user\" href=\"' + mw.util.getUrl('User:' + user) + '\">' + user + '</a> (<a href=\"' + mw.util.getUrl('User_talk:' + user) + '\">' + _msg('diff-usertalk') + '</a> | <a href=\"' + mw.util.getUrl('Special:Contributions/' + user) + '\">' + _msg('diff-usercontrib') + '</a> | <a href=\"' + mw.util.getUrl('Special:Block/' + user) + '\">' + _msg('diff-userblock') + '</a>)';\r\n    }\r\n    $modalTitle.html(_msg('diff-title') + ': <u>' + toTitle + '</u>');\r\n    $diffArea.show().html('').append(\r\n      $('<table>', { class: 'diff difftable' }).append(\r\n        $('<colgroup>').append(\r\n          $('<col>', { class: 'diff-marker' }),\r\n          $('<col>', { class: 'diff-content' }),\r\n          $('<col>', { class: 'diff-marker' }),\r\n          $('<col>', { class: 'diff-content' })\r\n        ),\r\n        $('<tbody>').append(\r\n          $('<tr>').append(\r\n            $('<td>', { colspan: 2, class: 'diff-otitle' }).append(\r\n              $('<a>', { href: config.wgScript + '?oldid=' + data.compare.fromrevid, text: data.compare.fromtitle }),\r\n              ' (',\r\n              $('<span>', { class: 'diff-version', text: _msg('diff-version') + data.compare.fromrevid }),\r\n              ') (',\r\n              $('<a>', { class: 'editLink', href: config.wgScript + '?action=edit&title=' + data.compare.fromtitle + '&oldid=' + data.compare.fromrevid, text: _msg('diff-edit') }),\r\n              ')',\r\n              $br,\r\n              userLink(data.compare.fromuser),\r\n              $br,\r\n              ' (',\r\n              $('<span>', { class: 'diff-comment', html: data.compare.fromparsedcomment }),\r\n              ') ',\r\n              $br,\r\n              $('<a>', { class: 'prevVersion ipe-analysis-quick_diff_modalclick', href: 'javascript:void(0);', text: '←' + _msg('diff-prev') }).click(() => {\r\n                quickDiff({\r\n                  fromrev: data.compare.fromrevid,\r\n                  torelative: 'prev'\r\n                });\r\n              })\r\n            ),\r\n            $('<td>', { colspan: 2, class: 'diff-ntitle' }).append(\r\n              $('<a>', { href: config.wgScript + '?oldid=' + data.compare.torevid, text: data.compare.totitle }),\r\n              ' (',\r\n              $('<span>', { class: 'diff-version', text: _msg('diff-version') + data.compare.torevid }),\r\n              ') (',\r\n              $('<a>', { class: 'editLink', href: config.wgScript + '?action=edit&title=' + data.compare.totitle + '&oldid=' + data.compare.torevid, text: _msg('diff-edit') }),\r\n              ')',\r\n              $br,\r\n              userLink(data.compare.touser),\r\n              $br,\r\n              ' (',\r\n              $('<span>', { class: 'diff-comment', html: data.compare.toparsedcomment }),\r\n              ') ',\r\n              $br,\r\n              $('<a>', { class: 'nextVersion ipe-analysis-quick_diff_modalclick', href: 'javascript:void(0);', text: _msg('diff-nextv') + '→' }).click(() => {\r\n                _analysis('quick_diff_modalclick');\r\n                quickDiff({\r\n                  fromrev: data.compare.torevid,\r\n                  torelative: 'next'\r\n                });\r\n              })\r\n            )\r\n          ),\r\n          diffTable,\r\n          $('<tr>', { class: 'diffSize', style: 'text-align: center' }).append(\r\n            $('<td>', { colspan: '2', text: data.compare.fromsize + _msg('diff-bytes') }),\r\n            $('<td>', { colspan: '2', text: data.compare.tosize + _msg('diff-bytes') })\r\n          )\r\n        )\r\n      )\r\n    );\r\n    $('.quick-diff button.toDiffPage').click(function () {\r\n      location.href = config.wgScript + '?oldid=' + data.compare.fromrevid + '&diff=' + data.compare.torevid;\r\n    });\r\n    articleLink($('.quick-diff .editLink'));\r\n    if (param.isPreview === true) {\r\n      $('.quick-diff button.toDiffPage').hide();\r\n      $diffArea.find('.diff-otitle').html('<b>' + _msg('diff-title-original-content') + '</b>');\r\n      $diffArea.find('.diff-ntitle').html('<b>' + _msg('diff-title-your-content') + '</b>');\r\n    }\r\n    if (data.compare.fromsize === undefined || data.compare.tosize === undefined) {\r\n      $diffArea.find('.diffSize').hide();\r\n    }\r\n    // 无上一版本或下一版本\r\n    if (data.compare.fromrevid === undefined && param.isPreview !== true) {\r\n      $diffArea.find('.diff-otitle').html('<span class=\"noPrevVerson\">' + data.warnings.compare['*'] + '</span>');\r\n    } else if (data.compare.torevid === undefined && param.isPreview !== true) {\r\n      $diffArea.find('.diff-ntitle').html('<span class=\"noNextVerson\">' + data.warnings.compare['*'] + '</span>');\r\n    }\r\n    // GitHub@issue#5 修复被隐藏版本的问题\r\n    if (data.compare.fromtexthidden !== undefined) {\r\n      $diffArea.find('.diff-otitle .diff-version').addClass('diff-hidden-history');\r\n    }\r\n    if (data.compare.totexthidden !== undefined) {\r\n      $diffArea.find('.diff-ntitle .diff-version').addClass('diff-hidden-history');\r\n    }\r\n    if (data.compare.fromuserhidden !== undefined) {\r\n      $diffArea.find('.diff-otitle .diff-user').addClass('diff-hidden-history');\r\n    }\r\n    if (data.compare.touserhidden !== undefined) {\r\n      $diffArea.find('.diff-ntitle .diff-user').addClass('diff-hidden-history');\r\n    }\r\n    if (data.compare.fromcommenthidden !== undefined) {\r\n      $diffArea.find('.diff-comment').addClass('diff-hidden-history');\r\n    }\r\n    if (data.compare.tocommenthidden !== undefined) {\r\n      $diffArea.find('.diff-ntitle .diff-comment').addClass('diff-hidden-history');\r\n    }\r\n    if (data.error) {\r\n      console.warn('[InPageEdit] 快速差异获取时系统告知出现问题');\r\n      $diffArea.html(_msg('diff-error') + ': ' + data.error.info + '(<code>' + data.error.code + '</code>)');\r\n    }\r\n  }).fail(function (errorCode, errorThrown) {\r\n    console.warn('[InPageEdit] 快速差异获取失败');\r\n    $loading.hide();\r\n    if (errorThrown.error && errorThrown.error.info && errorThrown.error.code) {\r\n      $diffArea.show().html(_msg('diff-error') + ': ' + errorThrown.error.info + '(<code>' + errorThrown.error.code + '</code>)');\r\n    } else {\r\n      $diffArea.show().html(_msg('diff-error'));\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  quickDiff\r\n}","const { _msg } = require('./_msg');\r\n\r\nconst api = require('./api.json');\r\nconst version = require('./version');\r\n\r\n/**\r\n * @module versionInfo 版本信息模块\r\n * @description Show Update Logs Modal box\r\n */\r\nvar versionInfo = function () {\r\n  // 显示模态框\r\n  ssi_modal.show({\r\n    className: 'in-page-edit update-logs-modal',\r\n    title: _msg('updatelog-title') + ' - <span id=\"yourVersion\">' + version + '</span>',\r\n    content: $('<section>').append(\r\n      $('<iframe>', { style: 'margin: 0;padding: 0;width: 100%;height: 80vh;border: 0;', src: api.updatelogsUrl })\r\n    ),\r\n    buttons: [{\r\n      label: 'GitHub',\r\n      className: 'btn btn-secondary',\r\n      method: function () {\r\n        window.open(api.githubLink);\r\n      }\r\n    }, {\r\n      label: _msg('updatelog-about'),\r\n      className: 'btn btn-secondary',\r\n      method: function () {\r\n        window.open(api.aboutUrl);\r\n      }\r\n    }, {\r\n      label: _msg('close'),\r\n      className: 'btn btn-primary',\r\n      method: function (a, modal) {\r\n        modal.close();\r\n      }\r\n    }]\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  versionInfo\r\n}","// const api = require('./api.json');\r\nconst { _msg } = require('./_msg')\r\n\r\n/**\r\n * @module specialNotice 特别通知\r\n */\r\nvar specialNotice = function () {\r\n  ssi_modal.notify('dialog', {\r\n    className: 'in-page-edit ipe-special-notice',\r\n    title: _msg('version-notice-title'),\r\n    content: _msg('version-notice'),\r\n    okBtn: {\r\n      label: _msg('updatelog-dismiss'),\r\n      className: 'btn btn-primary'\r\n    }\r\n  }, function (e, modal) {\r\n    localStorage.setItem('InPageEditNoticeId', _msg('noticeid'));\r\n    modal.close();\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  specialNotice\r\n}","var config = mw.config.get();\r\nconst { _msg } = require('./_msg');\r\n\r\nconst { preference } = require('./preference');\r\nconst { quickEdit } = require('./quickEdit');\r\n\r\n/**\r\n * @module articleLink 获取段落编辑以及编辑链接\r\n * @param {Element} element jQuery element to find edit links\r\n */\r\nvar articleLink = function (element) {\r\n  if (element === undefined) {\r\n    if (preference.get('redLinkQuickEdit') === true) {\r\n      element = $('#mw-content-text a');\r\n    } else {\r\n      element = $('#mw-content-text a:not(.new)');\r\n    }\r\n  }\r\n  element.each(function () {\r\n    if ($(this).attr('href') === undefined)\r\n      return;\r\n    var url = $(this).attr('href'),\r\n      action = mw.util.getParamValue('action', url) || mw.util.getParamValue('veaction', url),\r\n      title = mw.util.getParamValue('title', url),\r\n      section = mw.util.getParamValue('section', url) ? mw.util.getParamValue('section', url).replace(/T-/, '') : null,\r\n      revision = mw.util.getParamValue('oldid', url);\r\n\r\n    // 不是本地编辑链接\r\n    if (url.split('/')['2'] !== location.href.split('/')['2'] && url.substr(0, 1) !== '/')\r\n      return;\r\n\r\n    // 不是 index.php?title=FOO 形式的url\r\n    if (title === null) {\r\n      var splitStr = config.wgArticlePath.replace('$1', '');\r\n      if (splitStr === '/') {\r\n        splitStr = config.wgServer.substring(config.wgServer.length - 4) + '/';\r\n      }\r\n      title = url.split(splitStr).pop().split('?')['0'];\r\n    }\r\n\r\n    if (action === 'edit' && title !== undefined) {\r\n      $(this).after(\r\n        $('<span>', {\r\n          'class': 'in-page-edit-article-link-group'\r\n        }).append(\r\n          $('<a>', {\r\n            href: 'javascript:void(0)',\r\n            class: 'in-page-edit-article-link',\r\n            text: _msg('quick-edit')\r\n          }).click(function () {\r\n            var options = {};\r\n            options.page = title;\r\n            if (revision !== null) {\r\n              options.revision = revision;\r\n            } else if (section !== null) {\r\n              options.section = section;\r\n            }\r\n            if (!config.wgIsArticle) options.reload = false;\r\n            quickEdit(options);\r\n          })\r\n        )\r\n      );\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  articleLink\r\n}","const { _msg } = require('./_msg');\r\nconst { $br } = require('./_elements');\r\n\r\n/**\r\n * @module findAndReplace 查找替换模块\r\n * @param {element} element Textarea\r\n */\r\nfunction findAndReplace(element) {\r\n  if (element === undefined) element = $('.in-page-edit.ipe-editor:last .editArea');\r\n  var origin = element.val();\r\n\r\n  ssi_modal.show({\r\n    className: 'in-page-edit',\r\n    sizeClass: 'dialog',\r\n    center: true,\r\n    outSideClose: false,\r\n    // position: 'right bottom',\r\n    title: _msg('fAndR-title'),\r\n    content:\r\n      $('<div>', { class: 'module far-module' }).append(\r\n        $('<div>', { class: 'module_content', id: 'findfielddiv' }).append(\r\n          $('<section>').append(\r\n            $('<h4>', { text: _msg('fAndR-find-text') }),\r\n            $('<textarea>', { id: 'find_this', style: 'margin: 0', rows: 4 }),\r\n            $('<h4>', { text: _msg('fAndR-replace-text') }),\r\n            $('<textarea>', { id: 'replace_with', style: 'margin: 0', rows: 4 })\r\n          ),\r\n          $('<section>', { style: 'padding: 7px 0' }).append(\r\n            $('<label>').append(\r\n              $('<input>', { type: 'checkbox', id: 'globl', checked: '' }),\r\n              $('<span>', { text: _msg('fAndR-globl') })\r\n            ),\r\n            $br,\r\n            $('<label>').append(\r\n              $('<input>', { type: 'checkbox', id: 'case_sen' }),\r\n              $('<span>', { text: _msg('fAndR-case-sen') })\r\n            ),\r\n            $br,\r\n            $('<label>').append(\r\n              $('<input>', { type: 'checkbox', id: 'regex_search' }),\r\n              $('<span>', { text: _msg('fAndR-enable-regex') })\r\n            ),\r\n          )\r\n        )\r\n      ),\r\n    buttons: [\r\n      {\r\n        label: _msg('fAndR-button-undo'),\r\n        className: 'btn btn-danger',\r\n        method() {\r\n          element.val(origin);\r\n          ssi_modal.notify('info', {\r\n            className: 'in-page-edit',\r\n            title: _msg('notify-info'),\r\n            content: _msg('notify-fAndR-undo')\r\n          });\r\n          // modal.close();\r\n        }\r\n      },\r\n      {\r\n        className: 'btn btn-primary',\r\n        label: _msg('fAndR-button-replace'),\r\n        method() {\r\n          /**\r\n           * 查找替换主函数\r\n           * 借鉴：https://dev.fandom.com/wiki/MediaWiki:FindAndReplace/code.js\r\n           **/\r\n          if ($('#find_this').val() === '') return;\r\n          var searchfor = '',\r\n            searchexp,\r\n            $textarea = element,\r\n            replacewith = $('#replace_with').val().replace(/\\r/gi, ''),\r\n            text = $textarea.val().replace(/\\r/gi, ''),\r\n            flagg = 'g',\r\n            flagi = 'i',\r\n            enableregex = 0;\r\n\r\n          if ($('#globl').prop('checked') === false) {\r\n            flagg = '';\r\n          }\r\n          if ($('#case_sen').prop('checked') === true) {\r\n            flagi = '';\r\n          }\r\n          if ($('#regex_search').prop('checked') === true) {\r\n            enableregex = 1;\r\n          }\r\n          var flags = flagg + flagi + 'm';\r\n          if (enableregex === 1) {\r\n            searchfor = $('#find_this').val();\r\n          } else {\r\n            searchfor = $('#find_this').val().replace(/\\r/gi, '').replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1');\r\n          }\r\n          searchexp = new RegExp(searchfor, flags);\r\n          var rcount = 0;\r\n          var matched = text.match(searchexp);\r\n          if (matched !== null) {\r\n            rcount = matched.length;\r\n          }\r\n          text = text.replace(searchexp, replacewith);\r\n          $textarea.val(text);\r\n          ssi_modal.notify('success', {\r\n            className: 'in-page-edit',\r\n            title: _msg('notify-success'),\r\n            content: _msg('notify-fAndR-done', rcount)\r\n          });\r\n          // modal.close();\r\n        }\r\n      }\r\n    ]\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  findAndReplace\r\n}","const { _msg } = require('./_msg');\r\nconst { $progress } = require('./_elements');\r\n\r\nvar mwApi = new mw.Api();\r\n\r\n/**\r\n * @module quickPreview 快速预览文章页\r\n * @param params {Object} \r\n */\r\nvar quickPreview = function (params, modalSize = 'large', center = false) {\r\n  var defaultOptions = {\r\n    action: 'parse',\r\n    preview: true,\r\n    disableeditsection: true,\r\n    prop: 'text',\r\n    format: 'json'\r\n  }\r\n  var options = $.extend({}, defaultOptions, params);\r\n  mw.hook('InPageEdit.quickPreview').fire();\r\n  var timestamp = new Date().getTime();\r\n  console.time('[InPageEdit] Request preview');\r\n  ssi_modal.show({\r\n    sizeClass: new RegExp(/dialog|small|smallToMedium|medium|mediumToLarge|large|full|auto/).test(modalSize) ? modalSize : 'large',\r\n    center: Boolean(center),\r\n    className: 'in-page-edit previewbox',\r\n    title: _msg('preview-title'),\r\n    content: $('<section>').append(\r\n      $progress,\r\n      $('<div>', { class: 'InPageEditPreview', 'data-timestamp': timestamp, style: 'display:none', text: _msg('preview-placeholder') })\r\n    ),\r\n    fixedHeight: true,\r\n    fitScreen: true,\r\n    buttons: [{ label: '', className: 'hideThisBtn' }],\r\n    onShow() {\r\n      $('.previewbox .ipe-progress').css('margin-top', $('.previewbox .ipe-progress').parent().height() / 2);\r\n      $('.previewbox .hideThisBtn').hide();\r\n      mwApi.post(options).then(function (data) {\r\n        console.timeEnd('[InPageEdit] Request preview');\r\n        var content = data.parse.text['*'];\r\n        $('.previewbox .ipe-progress').hide(150);\r\n        $('.InPageEditPreview[data-timestamp=\"' + timestamp + '\"]').fadeIn(500).html(content);\r\n      }).fail(function () {\r\n        console.timeEnd('[InPageEdit] Request preview');\r\n        console.warn('[InPageEdit] 预览失败');\r\n        $('.previewbox .ipe-progress').hide(150);\r\n        $('.InPageEditPreview[data-timestamp=\"' + timestamp + '\"]').fadeIn(500).html(_msg('preview-error'));\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  quickPreview\r\n}","var mwApi = new mw.Api();\r\nvar config = mw.config.get();\r\nconst { _analysis } = require('./_analysis');\r\nconst { _msg } = require('./_msg');\r\nconst { _hasRight } = require('./_hasRight');\r\nconst { $br } = require('./_elements');\r\n\r\n/** \r\n * @module quickDelete 删除页面模块\r\n * @param {String} page\r\n */\r\nvar quickDelete = function (page, givenReason = '') {\r\n  mw.hook('InPageEdit.quickDelete').fire();\r\n  console.log('Quick delete', page, givenReason);\r\n  var reason;\r\n  page = page || config.wgPageName;\r\n\r\n  ssi_modal.show({\r\n    outSideClose: false,\r\n    className: 'in-page-edit quick-delete',\r\n    center: true,\r\n    sizeClass: 'dialog',\r\n    title: _msg('delete-title'),\r\n    content: $('<div>').append(\r\n      $('<section>', { id: 'InPageEditDeletepage' }).append(\r\n        $('<span>', { html: _msg('delete-reason', '<b>' + page.replace(/_/g, ' ') + '</b>') }),\r\n        $br,\r\n        $('<label>', { for: 'delete-reason', text: _msg('editSummary') }),\r\n        $('<input>', { id: 'delete-reason', style: 'width:96%', onclick: \"$(this).css('box-shadow', '')\", value: givenReason })\r\n      )\r\n    ),\r\n    beforeShow: function () {\r\n      if (!_hasRight('delete')) {\r\n        ssi_modal.dialog({\r\n          title: _msg('notify-no-right'),\r\n          content: _msg('delete-no-right'),\r\n          className: 'in-page-edit quick-deletepage',\r\n          center: true,\r\n          okBtn: {\r\n            className: 'btn btn-primary btn-single'\r\n          }\r\n        });\r\n        return false;\r\n      }\r\n    },\r\n    buttons: [\r\n      {\r\n        label: _msg('cancel'),\r\n        className: 'btn btn-primary',\r\n        method: function (e, modal) {\r\n          modal.close();\r\n        }\r\n      }, {\r\n        label: _msg('confirm'),\r\n        className: 'btn btn-danger',\r\n        method: function (e, modal) {\r\n          reason = $('#InPageEditDeletepage #delete-reason').val();\r\n          if (reason === '') {\r\n            $('#InPageEditDeletepage #delete-reason').css('box-shadow', '0 0 4px #f00');\r\n            return;\r\n          }\r\n          _analysis('quick_delete');\r\n\r\n          ssi_modal.confirm({\r\n            center: true,\r\n            className: 'in-page-edit',\r\n            title: _msg('delete-confirm-title'),\r\n            content: _msg('delete-confirm-content'),\r\n            okBtn: {\r\n              label: _msg('confirm'),\r\n              className: 'btn btn-danger'\r\n            },\r\n            cancelBtn: {\r\n              label: _msg('cancel'),\r\n              className: 'btn'\r\n            }\r\n          }, function (result) {\r\n            if (result) {\r\n              reason = _msg('delete-title') + ' (' + reason + ')';\r\n              mwApi.postWithToken('csrf', {\r\n                action: 'delete',\r\n                title: page,\r\n                reason: reason,\r\n                format: 'json'\r\n              }).then(() => {\r\n                ssi_modal.notify('success', {\r\n                  className: 'in-page-edit',\r\n                  title: _msg('notify-success'),\r\n                  content: _msg('notify-delete-success', page)\r\n                });\r\n              }).fail(function (errorCode, feedback, errorThrown) {\r\n                ssi_modal.notify('error', {\r\n                  className: 'in-page-edit',\r\n                  title: _msg('notify-error'),\r\n                  content: _msg('notify-delete-error') + ': <br/><span style=\"font-size:amall\">' + errorThrown.error['*'] + '(<code>' + errorThrown.error['code'] + '</code>)</span>'\r\n                });\r\n              });\r\n              modal.close();\r\n            } else {\r\n              return false;\r\n            }\r\n          });\r\n        }\r\n      }\r\n    ]\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  quickDelete\r\n}","const { _msg } = require('./_msg');\r\nconst { _hasRight } = require('./_hasRight');\r\n\r\nconst { quickDelete } = require('./quickDelete');\r\nconst { quickEdit } = require('./quickEdit');\r\n\r\n/**\r\n * @module _resolveExists 解决目标页面已存在的问题\r\n * @param {String} page 需要解决的页面\r\n * @param {Object|String} reason 填字符串则直接指定两种原因\r\n * @param {String} reason.delete 删除原因\r\n * @param {String} reason.edit 编辑原因\r\n */\r\nvar _resolveExists = function (page, reason = {}) {\r\n  var canDelete = _hasRight('delete');\r\n\r\n  if (typeof reason === 'string') {\r\n    reason = {\r\n      delete: reason,\r\n      edit: reason\r\n    }\r\n  }\r\n\r\n  ssi_modal.show({\r\n    className: 'in-page-edit resovle-exists',\r\n    sizeClass: 'dialog',\r\n    center: true,\r\n    outSideClose: false,\r\n    title: _msg('target-exists-title'),\r\n    content: _msg((canDelete ? 'target-exists-can-delete' : 'target-exists-no-delete'), page),\r\n    buttons: [\r\n      {\r\n        className: 'btn btn-danger btn-exists-delete-target',\r\n        label: _msg('quick-delete'),\r\n        method(a, modal) {\r\n          modal.close();\r\n          quickDelete(page, reason.delete || null);\r\n        }\r\n      },\r\n      {\r\n        className: 'btn btn-primary',\r\n        label: _msg('quick-edit'),\r\n        method() {\r\n          quickEdit({\r\n            page: page,\r\n            summary: (reason.edit ? '[InPageEdit] ' + reason : null),\r\n            reload: false\r\n          })\r\n        }\r\n      },\r\n      {\r\n        className: 'btn btn-secondary' + (canDelete ? ' btn-single' : ''),\r\n        label: _msg('cancel'),\r\n        method: (a, modal) => {\r\n          modal.close();\r\n        }\r\n      }\r\n    ],\r\n    onShow: () => {\r\n      if (!canDelete) {\r\n        $('.btn-exists-delete-target').hide();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  _resolveExists\r\n}","/**\r\n * @license GPL-3.0 GNU GENERAL PUBLIC LICENSE 3.0\r\n *\r\n * @name InPageEdit\r\n * @description A useful MediaWiki JavaScript Plugin written with jQuery\r\n * @author 机智的小鱼君 Dragon-Fish <dragon-fish@qq.com>\r\n * @url https://github.com/Dragon-Fish/InPageEdit-v2\r\n */\r\n\r\n!(async function () {\r\n  'use strict';\r\n\r\n  // 创建 InPageEdit 变量\r\n  var InPageEdit = window.InPageEdit || {};\r\n\r\n  // 防止多次运行\r\n  if (typeof InPageEdit.version !== 'undefined') {\r\n    throw '[InPageEdit] InPageEdit 已经在运行了';\r\n  }\r\n\r\n  // 初始化插件\r\n  var init = require('./method/init');\r\n\r\n  var mainFunctions = await init();\r\n\r\n  // 合并入全局变量\r\n  window.InPageEdit = $.extend({}, window.InPageEdit, mainFunctions);\r\n\r\n})();","// 导入方法\r\nconst _dir = require('./_dir');\r\nconst { loadScript } = require('./loadScript');\r\nconst { getUserInfo } = require('./getUserInfo');\r\nconst { loadStyles } = require('./loadStyles');\r\nconst { updateNotice } = require('./updateNotice');\r\nconst { syncI18nData } = require('./syncI18nData');\r\n\r\nconst version = require('../module/version');\r\n\r\n\r\n/**\r\n * @method initMain\r\n * @return {Object} InPageEdit\r\n */\r\nmodule.exports = async function init() {\r\n\r\n  // 加载样式表\r\n  loadStyles();\r\n\r\n  // 等待 i18n 缓存\r\n  await syncI18nData(\r\n    Boolean(\r\n      mw.util.getParamValue('i18n', location.href) === 'nocache' ||\r\n      version !== localStorage.getItem('InPageEditVersion')\r\n    )\r\n  );\r\n\r\n  // 等待前置插件\r\n  await loadScript(_dir + '/src/ssi_modal/ssi-modal.min.js');\r\n\r\n  // 导入全部模块\r\n  const { _analysis } = require('../module/_analysis');\r\n  const { _msg } = require('../module/_msg');\r\n  const { about } = require('../module/about');\r\n  const api = require('../module/api.json');\r\n  const { articleLink } = require('../module/articleLink');\r\n  const { findAndReplace } = require('../module/findAndReplace');\r\n  const { loadQuickDiff } = require('../module/loadQuickDiff');\r\n  const { preference } = require('../module/preference');\r\n  const { pluginStore } = require('../module/pluginStore');\r\n  const { progress } = require('../module/progress');\r\n  const { quickDelete } = require('../module/quickDelete');\r\n  const { quickDiff } = require('../module/quickDiff');\r\n  const { quickEdit } = require('../module/quickEdit');\r\n  const { quickPreview } = require('../module/quickPreview');\r\n  const { quickRedirect } = require('../module/quickRedirect');\r\n  const { quickRename } = require('../module/quickRename');\r\n  const { specialNotice } = require('../module/specialNotice');\r\n  const { versionInfo } = require('../module/versionInfo');\r\n\r\n  // 初始化前置模块\r\n  preference.set();\r\n  getUserInfo();\r\n  loadQuickDiff();\r\n  articleLink();\r\n  updateNotice();\r\n\r\n  // !暂定，触发工具盒插件\r\n  pluginStore.load('toolbox.js');\r\n\r\n  // 写入模块\r\n  var InPageEdit = {\r\n    _dir,\r\n    about,\r\n    api,\r\n    articleLink,\r\n    findAndReplace,\r\n    loadQuickDiff,\r\n    preference,\r\n    progress,\r\n    quickDelete,\r\n    quickDiff,\r\n    quickEdit,\r\n    quickPreview,\r\n    quickRedirect,\r\n    quickRename,\r\n    specialNotice,\r\n    version,\r\n    versionInfo,\r\n    // 别名 Alias\r\n    fnr: findAndReplace,\r\n    delete: quickDelete,\r\n    diff: quickDiff,\r\n    edit: quickEdit,\r\n    preview: quickPreview,\r\n    redirect: quickRedirect,\r\n    quickMove: quickRename,\r\n    rename: quickRename,\r\n  }\r\n\r\n  // 锁定重要变量\r\n  var importantVariables = [\r\n    '_dir',\r\n    'api',\r\n    'version',\r\n  ];\r\n  importantVariables.forEach(key => {\r\n    try {\r\n      Object.freeze(InPageEdit[key]);\r\n    } catch (e) {\r\n      // Do nothing\r\n    }\r\n  });\r\n\r\n  // 触发钩子，传入上下文\r\n  mw.hook('InPageEdit').fire({\r\n    _analysis,\r\n    _msg,\r\n    InPageEdit\r\n  });\r\n\r\n  // 花里胡哨的加载提示\r\n  console.info('    ____      ____                   ______    ___ __              _    _____ \\n   /  _/___  / __ \\\\____ _____ ____  / ____/___/ (_) /_            | |  / /__ \\\\\\n   / // __ \\\\/ /_/ / __ `/ __ `/ _ \\\\/ __/ / __  / / __/  ______    | | / /__/ /\\n _/ // / / / ____/ /_/ / /_/ /  __/ /___/ /_/ / / /_   /_____/    | |/ // __/ \\n/___/_/ /_/_/    \\\\__,_/\\\\__, /\\\\___/_____/\\\\__,_/_/\\\\__/              |___//____/ \\n                      /____/');\r\n\r\n  // 传回InPageEdit\r\n  return InPageEdit;\r\n}","var loadScript = function (src) {\r\n  return $.ajax({\r\n    url: src,\r\n    dataType: 'script',\r\n    crossDomain: true,\r\n    cache: true\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  loadScript\r\n}","var mwApi = new mw.Api();\r\n\r\nvar getUserInfo = function () {\r\n  /**\r\n * @description 获取用户权限信息\r\n */\r\n  mw.user.getRights().then(rights => {\r\n    console.info('[InPageEdit] 成功获取用户权限信息');\r\n    mw.config.set('wgUserRights', rights);\r\n  }).fail(function () {\r\n    console.warn('[InPageEdit] 警告：无法获取用户权限信息');\r\n    mw.config.set('wgUserRights', []);\r\n  });\r\n\r\n  /**\r\n   * @description 获取封禁状态\r\n   */\r\n  if (mw.user.getName() !== null) {\r\n    mwApi.get({\r\n      action: 'query',\r\n      list: 'users',\r\n      usprop: 'blockinfo',\r\n      ususers: mw.user.getName()\r\n    }).then(data => {\r\n      if (data.query.users[0].blockid) {\r\n        mw.config.set('wgUserIsBlocked', true);\r\n      } else {\r\n        mw.config.set('wgUserIsBlocked', false);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  getUserInfo\r\n}","const _dir = require(\"./_dir\");\r\n\r\nfunction loadStyles() {\r\n\r\n  // 放在越上面优先级越高\r\n  const styleFiles = [\r\n    // Default Skin\r\n    '/src/skin/ipe-default.css',\r\n    // ssi-modal Style\r\n    '/src/ssi_modal/ssi-modal.css',\r\n    // FontAwesome\r\n    'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css',\r\n  ];\r\n\r\n  styleFiles.forEach(link => {\r\n    if (/^https?:\\/\\//.test(link) !== true) {\r\n      link = _dir + link;\r\n    }\r\n    $('head').prepend(\r\n      $('<link>', { href: link, rel: 'stylesheet', 'data-ipe': 'style' })\r\n    );\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  loadStyles\r\n}","const version = require('../module/version');\r\n\r\nconst { _msg } = require('../module/_msg');\r\nconst api = require('../module/api.json');\r\nconst { versionInfo } = require('../module/versionInfo');\r\nconst { specialNotice } = require('../module/specialNotice');\r\n\r\nfunction updateNotice() {\r\n  if (localStorage.getItem('InPageEditVersion') !== version) {\r\n    ssi_modal.notify('', {\r\n      title: _msg('updatelog-update-success-title'),\r\n      content: _msg('updatelog-update-success', version),\r\n      className: 'in-page-edit',\r\n      buttons: [{\r\n        className: 'btn btn-primary',\r\n        label: _msg('updatelog-button-versioninfo'),\r\n        method(a, modal) {\r\n          localStorage.InPageEditVersion = version;\r\n          versionInfo();\r\n          modal.close();\r\n        }\r\n      }],\r\n      closeAfter: {\r\n        time: 30,\r\n        resetOnHover: true\r\n      },\r\n      onClose() {\r\n        ssi_modal.notify('', {\r\n          className: 'in-page-edit',\r\n          content: _msg('updatelog-after-close', `[${api.updatelogsUrl} ${api.updatelogsUrl}]`, `[${api.githubLink}/issues ${_msg('updatelog-file-issue')}]`),\r\n          closeAfter: {\r\n            time: 10\r\n          },\r\n          buttons: [{\r\n            className: 'btn btn-primary',\r\n            label: _msg('ok'),\r\n            method(a, modal) {\r\n              modal.close();\r\n            }\r\n          }]\r\n        });\r\n        localStorage.InPageEditVersion = version;\r\n      }\r\n    });\r\n  }\r\n  if (localStorage.getItem('InPageEditNoticeId') !== _msg('noticeid')) {\r\n    specialNotice();\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  updateNotice\r\n}","var config = mw.config.get();\r\n\r\nconst _dir = require('./_dir');\r\n\r\n// 设置\r\nconst cacheTime = 2 * 60 * 60 * 1000;\r\nconst cacheUrl = _dir + '/i18n/languages.json';\r\nconst funcName = 'InPageEdit';\r\nconst localCacheName = 'i18n-cache-' + funcName + '-content';\r\nconst localCacheTime = 'i18n-cache-' + funcName + '-timestamp';\r\n\r\n/**\r\n * @method i18n Get i18n data\r\n * @param {Boolean} noCache true - forced no cache\r\n */\r\nasync function syncI18nData(noCache) {\r\n  const now = new Date().getTime();\r\n  // 如果语言为 qqx，不返回任何东西\r\n  if (config.wgUserLanguage === 'qqx') {\r\n    console.warn('[InPageEdit] User language is qqx');\r\n    return true;\r\n  }\r\n  // 缓存存在且缓存未过期\r\n  if (localStorage.getItem(localCacheName) && (now - localStorage.getItem(localCacheTime)) < cacheTime && !noCache) {\r\n    var json = {}\r\n    try {\r\n      json = JSON.parse(localStorage.getItem(localCacheName))\r\n    } catch (e) {\r\n      console.warn('[InPageEdit] i18n 数据不合法');\r\n      await getOriginalData();\r\n      return true;\r\n    }\r\n    if (json.en) {\r\n      return true;\r\n    } else {\r\n      console.warn('[InPageEdit] i18n 数据可能已损坏');\r\n      await getOriginalData();\r\n      return true;\r\n    }\r\n  } else {\r\n    await getOriginalData();\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * @function saveToCache\r\n */\r\nfunction saveToCache(data) {\r\n  const now = new Date().getTime();\r\n  data = JSON.stringify(data);\r\n  localStorage.setItem(localCacheName, data);\r\n  localStorage.setItem(localCacheTime, now);\r\n}\r\n\r\n/**\r\n * @function getOriginalData\r\n */\r\nasync function getOriginalData() {\r\n  console.time('[InPageEdit] 从远程获取 i18n 数据');\r\n  var data = await $.getJSON(cacheUrl);\r\n  if (typeof data !== 'object') data = {}\r\n  saveToCache(data);\r\n  console.timeEnd('[InPageEdit] 从远程获取 i18n 数据');\r\n  return data;\r\n}\r\n\r\n\r\nmodule.exports = {\r\n  syncI18nData\r\n}","const { _msg } = require('./_msg');\r\n\r\nconst api = require('./api.json');\r\n\r\n/**\r\n * @module about 关于插件模块\r\n * @description Show \"What is\" modal box of IPE2\r\n */\r\nvar about = function () {\r\n  ssi_modal.show({\r\n    title: _msg('preference-about-label'),\r\n    className: 'in-page-edit in-page-edit-about',\r\n    content: $('<section>').append(\r\n      $('<iframe>', { style: 'margin: 0;padding: 0;width: 100%;height: 80vh;border: 0;', src: api.aboutUrl })\r\n    )\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  about\r\n}","var config = mw.config.get();\r\nconst { _msg } = require('./_msg');\r\nconst { _analysis } = require('./_analysis');\r\n\r\nconst { quickDiff } = require('./quickDiff');\r\n\r\n/**\r\n * @module loadQuickDiff 在特定页面查询差异链接并绑定快速差异\r\n */\r\nvar loadQuickDiff = function () {\r\n  // 最近更改\r\n  function addLink() {\r\n    $('.mw-changeslist-groupdiff, .mw-changeslist-diff, .mw-changeslist-diff-cur, .mw-history-histlinks a').unbind('click', ipeDiffLink);\r\n    var ipeDiffLink = $('.mw-changeslist-groupdiff, .mw-changeslist-diff, .mw-changeslist-diff-cur, .mw-history-histlinks a').click(function (e) {\r\n      e.preventDefault();\r\n      _analysis('quick_diff_recentchanges');\r\n      var $this = $(this),\r\n        href = $this.attr('href'),\r\n        diff = mw.util.getParamValue('diff', href),\r\n        curid = mw.util.getParamValue('curid', href),\r\n        oldid = mw.util.getParamValue('oldid', href);\r\n      if (diff === '0') {\r\n        quickDiff({ fromrev: oldid, toid: curid });\r\n      } else if (diff === 'prev' || diff === 'next' || diff === 'cur') {\r\n        quickDiff({ fromrev: oldid, torelative: diff });\r\n      } else {\r\n        quickDiff({ fromrev: oldid, torev: diff });\r\n      }\r\n    });\r\n  }\r\n  if ($('.mw-rcfilters-enabled').length > 0) {\r\n    setInterval(addLink, 500);\r\n    $('.mw-rcfilters-enabled').addClass('ipe-continuous-active');\r\n  } else {\r\n    addLink();\r\n  }\r\n  // 查看历史页面的比较按钮与快速编辑\r\n  if (config.wgAction === 'history') {\r\n    $('.historysubmit.mw-history-compareselectedversions-button').after(\r\n      $('<button>').text(_msg('quick-diff')).click(function (e) {\r\n        e.preventDefault();\r\n        _analysis('quick_diff_history_page');\r\n        var before = $('.selected.before').attr('data-mw-revid'),\r\n          after = $('.selected.after').attr('data-mw-revid');\r\n        quickDiff({ fromrev: after, torev: before });\r\n      })\r\n    );\r\n    $('[data-mw-revid]').each(function () {\r\n      var $this = $(this),\r\n        oldid = $this.attr('data-mw-revid');\r\n      $this.find('.mw-history-undo').after(\r\n        $('<span>').html(' | <a class=\"in-page-edit-article-link\" href=\"javascript:void(0);\" onclick=\"InPageEdit.quickEdit({page:mw.config.get(\\'wgPageName\\'),revision:' + oldid + '});\">' + _msg('quick-edit') + '</a>')\r\n      );\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  loadQuickDiff\r\n}","/********************************\r\n ********** 未完工的模块 **********\r\n ********************************/\r\n\r\nconst pluginsIndex = require('../plugins/index.json');\r\nconst _dir = require('../method/_dir');\r\nconst _msg = require('./_msg');\r\n\r\n/**\r\n * @module pluginStore 加载InPageEdit插件\r\n */\r\nvar pluginStore = {\r\n  /**\r\n   * @module pluginStore.get 打开插件商店\r\n   */\r\n  get() {\r\n    ssi_modal.show({\r\n      className: 'in-page-edit plugins-store',\r\n      sizeClass: 'dialog',\r\n      center: true,\r\n      title: _msg('plugins-store-title'),\r\n      content: 'Under development...',\r\n      buttons: [{\r\n        label: _msg('ok'),\r\n        className: 'btn btn-single',\r\n        method(a, modal) {\r\n          modal.close();\r\n        }\r\n      }]\r\n    })\r\n  },\r\n  /**\r\n   * @module pluginStore.load 载入插件\r\n   * @param {String} name \r\n   */\r\n  load(name) {\r\n    if (pluginsIndex[name]) {\r\n      mw.loader.load(_dir + '/plugins/' + name);\r\n    } else {\r\n      console.warn('[InPageEdit] 无法找到插件', name);\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  pluginStore\r\n}","var mwApi = new mw.Api();\r\nvar config = mw.config.get();\r\n\r\nconst { _analysis } = require('./_analysis');\r\nconst { _msg } = require('./_msg');\r\nconst { $br, $progress } = require('./_elements');\r\n\r\nconst { _resolveExists } = require('./_resolveExists');\r\nconst { preference } = require('./preference');\r\n\r\n/**\r\n * @module quickRedirect 快速重定向模块\r\n * @param {'from'|'to'} type\r\n */\r\nvar quickRedirect = function (type = 'to') {\r\n  mw.hook('InPageEdit.quickRedirect').fire();\r\n  var text = '#REDIRECT [[:$1]]',\r\n    question,\r\n    target,\r\n    json = {\r\n      action: 'edit',\r\n      createonly: 1,\r\n      minor: preference.get('editMinor'),\r\n      format: 'json',\r\n      errorformat: 'plaintext'\r\n    },\r\n    summary;\r\n\r\n  if (type === 'to') {\r\n    json.title = config.wgPageName;\r\n    question = _msg('redirect-question-to', '<b>' + config.wgPageName.replace(/_/g, ' ') + '</b>');\r\n  } else if (type === 'from') {\r\n    question = _msg('redirect-question-from', '<b>' + config.wgPageName.replace(/_/g, ' ') + '</b>');\r\n    summary = _msg('redirect-summary') + ' → [[:' + config.wgPageName + ']]';\r\n    json.text = text.replace('$1', config.wgPageName);\r\n  } else {\r\n    console.error('[InPageEdit] quickRedirect only accept \"from\" or \"to\"');\r\n    return;\r\n  }\r\n\r\n  ssi_modal.show({\r\n    outSideClose: false,\r\n    className: 'in-page-edit quick-redirect',\r\n    center: true,\r\n    sizeClass: 'dialog',\r\n    title: _msg('redirect-title'),\r\n    content: $('<div>').append(\r\n      $('<section>').append(\r\n        $('<span>', { html: question }),\r\n        $br,\r\n        $('<input>', { id: 'redirect-page', style: 'width:96%' }).click(function () { $(this).css('box-shadow', '') }),\r\n        $br,\r\n        $('<label>', { for: 'redirect-reason', text: _msg('editSummary') }),\r\n        $('<input>', { id: 'redirect-reason', style: 'width:96%' })\r\n      ),\r\n      $($progress).css('display', 'none')\r\n    ),\r\n    buttons: [{\r\n      label: _msg('confirm'),\r\n      className: 'btn btn-primary btn-single okBtn',\r\n      method: function (a, modal) {\r\n        target = $('.in-page-edit.quick-redirect #redirect-page').val();\r\n        if (target === '' || target.replace(/_/g, ' ') === config.wgPageName.replace(/_/g, ' ')) {\r\n          $('.in-page-edit.quick-redirect #redirect-page').css('box-shadow', '0 0 4px #f00');\r\n          return;\r\n        }\r\n\r\n        _analysis('quick_redirect');\r\n\r\n        if (type === 'to') {\r\n          summary = _msg('redirect-summary') + ' → [[:' + target + ']]';\r\n          json.text = text.replace('$1', target);\r\n        } else if (type === 'from') {\r\n          json.title = target;\r\n        }\r\n        if ($('.in-page-edit.quick-redirect #redirect-reason').val() !== '') {\r\n          summary = summary + ' (' + $('.in-page-edit.quick-redirect #redirect-reason').val() + ')';\r\n        }\r\n        json.summary = summary;\r\n\r\n        $('.in-page-edit.quick-redirect .ipe-progress').show();\r\n        $('.in-page-edit.quick-redirect section').hide();\r\n        $('.in-page-edit.quick-redirect .okBtn').attr('disabled', 'disabled');\r\n\r\n        mwApi.postWithToken('csrf', json).done(successed).fail(failed);\r\n        // 重定向成功\r\n        function successed(data) {\r\n          if (data.errors) {\r\n            failed(data.errors[0].code, data);\r\n            return;\r\n          }\r\n          $('.in-page-edit.quick-redirect .ipe-progress').addClass('done');\r\n          ssi_modal.notify('success', {\r\n            className: 'in-page-edit',\r\n            content: _msg('notify-redirect-success'),\r\n            title: _msg('notify-success')\r\n          });\r\n          if (type === 'to') {\r\n            window.location.reload();\r\n          } else {\r\n            $('.in-page-edit.quick-redirect .ipe-progress').addClass('done');\r\n            setTimeout(function () { modal.close() }, 2000);\r\n          }\r\n        }\r\n        // 重定向失败\r\n        function failed(errorCode, errorThrown) {\r\n          $('.in-page-edit.quick-redirect .ipe-progress').hide();\r\n          $('.in-page-edit.quick-redirect section').show();\r\n          $('.in-page-edit.quick-redirect .okBtn').attr('disabled', false);\r\n          $('.in-page-edit.quick-redirect .ipe-progress').addClass('done');\r\n          ssi_modal.notify('error', {\r\n            className: 'in-page-edit',\r\n            content: _msg('notify-redirect-error') + '<br>' + errorThrown.errors[0]['*'] + ' (<code>' + errorCode + '</code>)',\r\n            title: _msg('notify-error')\r\n          });\r\n          // 如果是由于页面存在，给出解决方案\r\n          if (errorCode === 'articleexists') {\r\n            var fromPage,\r\n              toPage;\r\n            if (type === 'from') {\r\n              fromPage = target;\r\n              toPage = config.wgPageName;\r\n            } else if (type === 'to') {\r\n              fromPage = config.wgPageName;\r\n              toPage = target;\r\n            }\r\n            _resolveExists(fromPage, {\r\n              delete: 'Delete for redirect to [[' + toPage + ']]',\r\n              edit: 'Modify for redirect'\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    ]\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  quickRedirect\r\n}","var mwApi = new mw.Api();\r\nvar config = mw.config.get();\r\n\r\nconst { _analysis } = require('./_analysis');\r\nconst { _msg } = require('./_msg');\r\nconst { _hasRight } = require('./_hasRight');\r\nconst { _resolveExists } = require('./_resolveExists');\r\nconst { $br } = require('./_elements');\r\n\r\nconst { progress } = require('./progress');\r\n\r\n/**\r\n * @module quickRename 快速重命名模块\r\n * @param {String} from\r\n * @param {String} to\r\n */\r\nvar quickRename = function (from, to) {\r\n  mw.hook('InPageEdit.quickRename').fire();\r\n  from = from || config.wgPageName;\r\n  to = to || '';\r\n  var reason,\r\n    movetalk,\r\n    movesubpages,\r\n    noredirect;\r\n\r\n  ssi_modal.show({\r\n    outSideClose: false,\r\n    className: 'in-page-edit quick-rename',\r\n    center: true,\r\n    sizeClass: 'dialog',\r\n    title: _msg('rename-title'),\r\n    content:\r\n      $('<section>').append(\r\n        $('<label>', { for: 'move-to', html: _msg('rename-moveTo', '<b>' + from.replace(/_/g, ' ') + '</b>') }),\r\n        $br,\r\n        $('<input>', { id: 'move-to', style: 'width:96%', onclick: \"$(this).css('box-shadow','')\" }),\r\n        $br,\r\n        $('<label>', { for: 'move-reason', text: _msg('editSummary') }),\r\n        $br,\r\n        $('<input>', { id: 'move-reason', style: 'width:96%' }),\r\n        $br,\r\n        $('<label>').append(\r\n          $('<input>', { type: 'checkbox', id: 'movetalk', checked: 'checked' }),\r\n          $('<span>', { text: _msg('rename-movetalk') })\r\n        ),\r\n        $br,\r\n        $('<label>').append(\r\n          $('<input>', { type: 'checkbox', id: 'movesubpages', checked: 'checked' }),\r\n          $('<span>', { text: _msg('rename-movesubpages') })\r\n        ),\r\n        $br,\r\n\r\n        $('<label>').append(\r\n          $('<input>', { type: 'checkbox', id: 'noredirect' }),\r\n          $('<span>', { text: _msg('rename-noredirect') })\r\n        ),\r\n      ),\r\n    buttons: [{\r\n      label: _msg('cancel'),\r\n      className: 'btn btn-secondary',\r\n      method: function (a, modal) {\r\n        modal.close();\r\n      }\r\n    }, {\r\n      label: _msg('confirm'),\r\n      className: 'btn btn-primary',\r\n      method: function () {\r\n        to = $('.in-page-edit.quick-rename #move-to').val();\r\n        if (to === '' || to === config.wgPageName || to === config.wgPageName.replace(/_/g, ' ')) {\r\n          $('.in-page-edit.quick-rename #move-to').css('box-shadow', '0 0 4px #f00');\r\n          return;\r\n        }\r\n\r\n        _analysis('quick_move');\r\n\r\n        progress(_msg('editor-title-saving'));\r\n        movetalk = $('.in-page-edit.quick-rename #movetalk').prop('checked');\r\n        movesubpages = $('.in-page-edit.quick-rename #movesubpages').prop('checked');\r\n        noredirect = $('.in-page-edit.quick-rename #noredirect').prop('checked');\r\n        reason = $('.in-page-edit.quick-rename #move-reason').val();\r\n\r\n        if (reason === '') {\r\n          reason = _msg('rename-summary') + ' → [[:' + to + ']]';\r\n        } else {\r\n          reason = _msg('rename-summary') + ' → [[:' + to + ']] (' + reason + ')';\r\n        }\r\n        mwApi.postWithToken('csrf', {\r\n          action: 'move',\r\n          from: from,\r\n          to: to,\r\n          reason: reason,\r\n          movetalk: movetalk,\r\n          movesubpages: movesubpages,\r\n          noredirect: noredirect\r\n        }).done(function () {\r\n          progress(true);\r\n          ssi_modal.notify('success', {\r\n            className: 'in-page-edit',\r\n            content: _msg('notify-rename-success'),\r\n            title: _msg('notify-success')\r\n          });\r\n          location.href = config.wgArticlePath.replace('$1', to);\r\n        }).fail(function (errorCode, feedback, errorThrown) {\r\n          progress(false);\r\n          ssi_modal.notify('error', {\r\n            className: 'in-page-edit',\r\n            content: _msg('notify-rename-error') + ': ' + errorThrown.error.info + '<code>' + errorThrown.error.code + '</code>',\r\n            title: _msg('notify-error')\r\n          });\r\n          // 如果原因是页面已存在，给出解决方案\r\n          if (errorThrown.error.code === 'articleexists') {\r\n            _resolveExists(to, 'For move page [[' + from + ']] to here.');\r\n          }\r\n        });\r\n      }\r\n    }],\r\n    beforeShow: function () {\r\n      if (!_hasRight('move')) {\r\n        ssi_modal.dialog({\r\n          title: _msg('notify-no-right'),\r\n          content: _msg('rename-no-right'),\r\n          className: 'in-page-edit quick-deletepage',\r\n          center: true,\r\n          okBtn: {\r\n            className: 'btn btn-primary btn-single'\r\n          }\r\n        });\r\n        return false;\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  quickRename\r\n}"],"sourceRoot":""}